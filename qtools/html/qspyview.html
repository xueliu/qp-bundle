<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QTools: QSpyView&trade; Visualization &amp; Monitoring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a id="logo" title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com"></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QTools
   &#160;<span id="projectnumber">6.8.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('qspyview.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">QSpyView&trade; Visualization &amp; Monitoring </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#qspyview_about">About QSpyView&trade;</a><ul><li class="level2"><a href="#qspyview_special">What&#39;s Special About QSpyView&trade;?</a></li>
</ul>
</li>
<li class="level1"><a href="#qspyview_struct">QSpyView&trade; Structure</a></li>
<li class="level1"><a href="#qspyview_install">Installing QSpyView&trade; and Tcl/Tk</a><ul><li class="level2"><a href="#qspyview_windows">Windows</a></li>
<li class="level2"><a href="#qspyview_linux">Linux</a></li>
</ul>
</li>
<li class="level1"><a href="#qspyview_run">Running QSpyView&trade;</a><ul><li class="level2"><a href="#qspyview_attaching">Attaching QSpyView to QSPY</a></li>
<li class="level2"><a href="#qspyview_tstamp">Recognizing the Target</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="qspyview_about"></a>
About QSpyView™</h1>
<p>QSpyView&trade; is a powerful <b>Visualization and Monitoring</b> facility, which allows embedded developers to rapidly create <em>virtual Graphical User Interfaces</em> to monitor and control their embedded devices from a host (desktop) computer. The interfaces created by QSpyView&trade; can visualize the tracing data produced by QP/Spy&trade; and can also <b>send</b> various commands to the embedded target. </p>
<dl class="section note"><dt>Note</dt><dd>A visualization and monitoring system like QSpyView&trade; can be used in all stages of development, manufacturing, and after the deployment, for in-field servicing of embedded devices.</dd></dl>
<div class="image">
<img src="qspyview_ex.png" alt=""/>
<div class="caption">
Example of a QSpyView&trade; session on an embedded board (EFM32-SLSTK)</div></div>
<p>As you can see in the figure above, a QSpyView&trade; user interface consists of the text box with extensible menus plus a customizable canvas that can display the QP/Spy&trade; data in an attractive graphical format, such as animations, graphs, etc. and can contain controls, such as buttons, sliders, etc. The actual functionality of the <em>virtual GUI</em> obviously depends on the target system and the embedded code it is running. Therefore, the QSpyView&trade; provides only a skeleton, which is then <b>customized</b> by user-supplied scripts.</p>
<div class="separate"></div> <h2><a class="anchor" id="qspyview_special"></a>
What's Special About QSpyView™?</h2>
<p>The GUIs created with QSpyView&trade; are naturally platform-neutral and run without any changes on Windows, Linux, or macOS.</p>
<p>QSpyView&trade; currently supports the following <a class="el" href="qspyview_ui.html">commands</a> (<b>NOTE:</b> QSpyView&trade; is <a class="el" href="qspyview_cust.html">extensible</a> with functionality specific to the project at hand, so it can provide many more features on top of the basic functionality enumerated below):</p>
<ul>
<li>Set <a class="el" href="qs.html#qs_global">global QS filters</a> inside the Target</li>
<li>Set <a class="el" href="qs.html#qs_local">local QS filters</a> inside the Target</li>
<li>Inject an arbitrary event to the Target (direct post or publish)</li>
<li>Execute a user-defined callback function inside the Target with arguments supplied from QSpyView&trade;</li>
<li>Peek data inside the Target and send to QSpyView&trade;</li>
<li>Poke data (supplied from QSpyView&trade;) into the Target</li>
<li>Execute clock tick inside the Target</li>
<li>Request target information (version, all sizes of objects, build time-stamp)</li>
<li>Remotely reset the Target</li>
</ul>
<dl class="section remark"><dt>Remarks</dt><dd><b>Why UDP?</b> The <a class="el" href="qspy_udp.html">communication between QSPY and QSpyView</a> is based on UDP, because UDP is inherently packet-oriented (as opposed to TCP, which is stream-oriented) and preserves the <em>packet boundaries</em>.</dd></dl>
<hr  />
 <h1><a class="anchor" id="qspyview_struct"></a>
QSpyView™ Structure</h1>
<p>The sequence diagram below shows the general structure of QSpyView&trade;. The embedded Target is running an instrumented code that communicates with the <a class="el" href="qspy.html">QSPY Host application</a> over the <a class="el" href="qspy.html#qspy_link">Target data link</a> (<span style="color:red"><b>red arrows</b></span>). This communication is based on the <a class="el" href="qpspy_proto.html">QP/Spy Protocol</a>.</p>
<p>The QSpyView&trade; (Tcl/Tk script) attaches to the QSPY host application by means of the <a class="el" href="qspy_udp.html">UDP socket</a> that QSPY opens when the <code>-u</code> <a class="el" href="qspy.html#qspy_command">command-line option</a> is selected. This communication (<span style="color:blue"><b>blue arrows</b></span>) uses the same packet structure as the <a class="el" href="qpspy_proto.html">QP/Spy Protocol</a>, but without the HDLC framing, without transparency (escaping), and without the checksum.</p>
<dl class="section note"><dt>Note</dt><dd>The QSpyView Front-End attaches to the <a class="el" href="qspy_udp.html#udp_channel">binary-channel</a> of the UDP socket served by QSPY (<span style="color:blue"><b>blue arrows</b></span> in the sequence diagram below).</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>The <a class="el" href="qspy_udp.html#udp_channel">QSPY UDP channel</a> should <b>not</b> be confused with the <a class="el" href="qspy.html#qspy_link">QSPY target communication channel</a> (<span style="color:red"><b>red arrows</b></span> in the sequence diagram below), which can be serial-port, TCP/IP, or a binary-file.</dd></dl>
<div class="image">
<img src="qspy_qspyview.gif" alt=""/>
<div class="caption">
Communication between Target, QSPY, and QSpyView</div></div>
<ul class="tag">
<li>
<p class="startli"><span class="tag">A</span> The QSPY Back-End forwards <b>all</b> trace records produced by the Target to the UDP Socket, so that any attached Front-End (such as QSpyView&trade;) receives all this data. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><span class="tag">B</span> The QSPY Back-End relays all UDP packets with <a class="el" href="qpspy_proto.html">Record-ID</a> in the range <code>0..127</code> to the Target. </p>
<p class="endli"></p>
</li>
<li>
<span class="tag">C</span> UDP packets with <a class="el" href="qpspy_proto.html">Record-ID</a> in the range <code>128..255</code> are not relayed to the Target, but instead are used for communication between the QSpyView&trade; Front-End and the QSPY Back-End.  </li>
</ul>
<hr  />
 <h1><a class="anchor" id="qspyview_install"></a>
Installing QSpyView™ and Tcl/Tk</h1>
<p>QSpyView&trade; is bundled with QSPY and is installed automatically when you install QTools. Specifically, QSpyView&trade; consists of the <span class="img file_tcl">qspy.tcl</span> and <span class="img file_wish">qspyview.tcl</span> Tcl scripts located in the qtools\qspy\qspyview folder.</p>
<div class="separate"></div> <h2><a class="anchor" id="qspyview_windows"></a>
Windows</h2>
<p>In order to run QSpyView&trade;, you need the <em>Tk interpreter</em> called <b>wish</b> installed on your machine. <code>Wish</code> (version 8.4) is included in the QTools collection for Windows, so it will be available if you install QTools. Also, the Tcl/Tk distribution included in QTools has been already extended with the UDP-Sockets for Tcl, so you can use the <code>tclsh</code> and <code>wish</code> interpreters "as is" without any additional modifications.</p>
<div class="separate"></div> <h2><a class="anchor" id="qspyview_linux"></a>
Linux</h2>
<p>On Linux, Tcl/Tk is usually installed, but you need to augment the standard Tcl/Tk distribution with the UDP Sockets for Tcl.</p>
<dl class="section note"><dt>Note</dt><dd>All the tools and instructions of adding UDP Sockets to Tcl are included in the QTools collection for Linux, in the <span class="img folder">tcludp</span> folder (see QSPY directories and files)</dd></dl>
<hr  />
 <h1><a class="anchor" id="qspyview_run"></a>
Running QSpyView™</h1>
<p>Being a Tcl/Tk application, QSpyView&trade; requires the Tk interpreter called <b>wish</b> (windowing shell) to run. This Tcl/Tk interpreter needs to be augmented with the <a href="http://tcludp.sourceforge.net/" target="_blank" class="extern">UDP socket extension</a>, because the standard Tcl/Tk distributions typically don't support UDP. (<b>NOTE:</b> The Tcl/Tk interpreters included in the <a href="https://sourceforge.net/projects/qpc/files/QTools/" target="_blank" class="extern">QTools collection for Windows</a> are already augmented with the UDP socket extension, so you don't need to do anything to use them for QSpyView&trade;).</p>
<p>In the simplest form, QSpyView&trade; might be started by changing to the folder <code>qtools\qspy\qspyview</code> and double-clicking on the <span class="img file_wish">qspyview.tcl</span> script. Alternatively, you might open the Command Prompt and type:</p>
<pre class="fragment">wish qspyview.tcl
</pre><p>This would launch QSpyView&trade; in the "default" configuration, without any <a class="el" href="qspyview_cust.html">customization</a> specific to a project at hand.</p>
<p>However, it also possible to launch QSpyView&trade; <a class="el" href="qspyview_cust.html">customized to a particular project</a>, such as the DPP application, by providing commands and views specific to the project at hand. For this QSpyView&trade; provides an extension mechanism to provide another script as a <em>command-line parameter</em> to the <span class="img file_wish">qspyview.tcl</span> script.</p>
<dl class="section note"><dt>Note</dt><dd>QSpyView takes up to three optional command-line parameters, with the following usage:<br  />
<br  />
<code>wish qspyview.tcl [&lt;cust_script&gt; [&lt;qspy_host&gt; [&lt;qspy_port&gt;]]]</code><br  />
<br  />
where <code>&lt;cust_script&gt;</code> is the customization script (e.g., <code>dpp.tcl</code>), <code>&lt;qspy_host&gt;</code> is the network host name or IP address of the host running the QSPY "Back-End", and <code>&lt;qspy_port&gt;</code> is the UDP port number opened by the QSPY "Back-End". If the parameters <code>&lt;qspy_host&gt;</code> and <code>&lt;qspy_port&gt;</code> are not provided, the defaults of <code>localhost</code> and <code>7701</code> are assumed.</dd></dl>
<p>For example, the DPP example provides the extension script named <span class="img file_wish">dpp.tcl</span>, located in the QP examples directory. In this case, you need to choose from which directory you want to launch QSpyView&trade;. If you choose to launch it from the directory containing the extension script, you need to fully-qualify the location of the <span class="img file_wish">qspyview.tcl</span> script, as follows:</p>
<pre class="fragment">wish %QTOOLS%\qspy\qspyview\qspyview.tcl dpp.tcl
</pre><dl class="section note"><dt>Note</dt><dd>In practice, the easiest way to launch QSpyView&trade; is to define a <b>shortcut</b>, like the one provided with the DPP example:<br  />
<br  />
<div class="image">
<img src="qspyview_shortcut.gif" alt=""/>
<div class="caption">
qspyview shortcut properties</div></div>
</dd></dl>
<div class="separate"></div> <h2><a class="anchor" id="qspyview_attaching"></a>
Attaching QSpyView to QSPY</h2>
<p>In contrast to TCP, which is stream-oriented, UDP is packet-oriented, so the only way to "attach" two ends of communication is to exchange packets. Consequently, immediately after QSpyView&trade; is launched, it tries to <b>attach</b> by sending the <a class="el" href="qspy_udp.html#udp_ATTACH">ATTACH</a> packet to QSPY. If QSPY responds with the ATTACH response, QSpyView&trade; considers that it is "attached".</p>
<p>However, if the ATTACH response does not arrive within a second or two (because perhaps QSPY is not running), QSpyView&trade; opens a modal dialog box that reminds you to run QSPY with the <code>-u</code> command-line option, as shown in the screen-shot below:</p>
<div class="image">
<img src="qspyview_before.gif" alt=""/>
<div class="caption">
Attach to QSPY dialog box</div></div>
<p>Depending how you start <a class="el" href="qspy.html">QSPY</a>, the dialog box might close automatically, which means that QSpyView has successfully <b>attached</b> to QSPY. However, if the dialog box does not close, you need to click the <b>OK</b> button to send <a class="el" href="qspy_udp.html#udp_ATTACH">ATTACH</a> packet to QSPY, until QSpyView&trade; receives the ATTACH response from QSPY. If you can't "attach", you can click the <b>Cancel</b> button to close QSpyView&trade;.</p>
<dl class="section note"><dt>Note</dt><dd>Because UDP works over networks, the QSPY Back-End can run on a <b>different machine</b> (e.g., a lab computer) that the the QSpyView&trade; Front-End (e.g., office computer). These two machines can even run different operating systems, for example Linux on the lab computer and Windows in the office, or vice versa. All you need to do is to provide the host-name parameter as the <em>third</em> command-line argument to the <code>qspyview.tcl</code> script (e.g., <code>wish qspyview.tcl dpp.tcl 192.168.1.101</code>).</dd></dl>
<div class="separate"></div> <h2><a class="anchor" id="qspyview_tstamp"></a>
Recognizing the Target</h2>
<p>Before QSpyView&trade; can correctly interpret any data from the Target, it needs to obtain certain information about the Target, such as the sizes of object pointers, function pointers, event signals, etc. This information is provided in the <a class="el" href="qs__copy_8h.html#acdb495c1e5524b5d95aaff82c47f6db5a6a73ed1da89600585ca91b5572941ea4" title="reports the Target information">QS_TARGET_INFO</a> trace record coming from the Target.</p>
<p>To inform you about the Target status, QSpyView&trade; displays the <b>Target: UNKNOWN</b> in the status bar when the target is "unknown":</p>
<div class="image">
<img src="qspyview_unknown.gif" alt=""/>
<div class="caption">
Target UNKNONW status</div></div>
<p>If this happens, you can explicitly request the Target information by means of the "Commands-&gt;Query Target Info" menu:</p>
<div class="image">
<img src="qspyview_known.gif" alt=""/>
<div class="caption">
Target KNONW status (build time-stamp)</div></div>
<p>After the Target information is received, the QSpyView&trade; status bar shows the build time-stamp of the Target image.</p>
<hr  />
<p><b>Next:</b> <a class="el" href="qspyview_ui.html">QSpyView User Interface</a></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QTools 6.8.0</b>
    </li>
  </ul>
</div>
</body>
</html>
