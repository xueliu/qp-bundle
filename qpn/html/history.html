<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP-nano: Revision History</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a id="logo" title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com"></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QP-nano
   &#160;<span id="projectnumber">6.8.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('history.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Revision History </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="qpn_6_8_0"></a>
Version 6.8.0, 2020-03-31</h1>
<p>Source code changes:</p>
<ul>
<li>Fixed inconsistencies between QP API declarations in the .h files and definitions in the .c files, such as different parameter names in declarations and definitions (MISRA-C:2012).</li>
<li>Removed a lot of excessive type casting of compile-time constants, such as <code>(uint8_t)0</code>, which is now coded simply as <code>0U</code></li>
<li>Introduced <a class="el" href="qassert_8h.html#a3c9a47863f0f4254858b3387335869cb" title="no-return function specifier">Q_NORETURN</a> macro for <a class="el" href="qassert_8h.html#ad3eef817e4c78a3740bea0edacb4adbd" title="Callback function invoked in case of any assertion failure.">Q_onAssert()</a>, which can (if defined) inform the compiler that <a class="el" href="qassert_8h.html#ad3eef817e4c78a3740bea0edacb4adbd" title="Callback function invoked in case of any assertion failure.">Q_onAssert()</a> does not return. This can potentially improve the code generation and can improve diagnostics generated by the compiler as well as static code analysis tools.</li>
</ul>
<p>Updated Examples:</p>
<p>Converted most of the examples for ARM-MDK from the no-longer maintained compiler-5 (RVDS) to the new ARM Compiler-6 (ARM-clang). The examples for ARM Compiler-6 are located in the <code>armclang</code> sub-directories.</p>
<dl class="section note"><dt>Note</dt><dd>The older ARM Compiler-5 is still supported, but will be phased out in the future. The only examples for ARM Compiler-5 are for the EK-TM4C123GXL (TivaC LanuchPad) board. These examples are located in the <code>arm</code> sub-directories.</dd></dl>
<hr  />
 <h1><a class="anchor" id="qpn_6_7_0"></a>
Version 6.7.0, 2019-12-30</h1>
<p>The main purpose of this release is providing improved compliance with MISRA-C:2012 (including MISRA-C:2012-Amendment-1) and also to provide support for the <a href="https://www.gimpel.com/"><b>PC-Lint-Plus</b></a> static analysis tool (see also feature request <a href="https://sourceforge.net/p/qpc/feature-requests/169/">#169</a>). Specifically, the QP-nano source code and some examples have been adjusted to comply with MISRA-C:2012-Amendment-1 rules, with all deviations captured in the PC-Lint-Plus configuration files. These PC-Lint-Plus configuration files have been provided in the new "port" to PC-Lint-Plus in the directory qpn/ports/lint-plus/.</p>
<dl class="section note"><dt>Note</dt><dd>The support for the older PC-Lint 9.x and the older MISRA-C:2004 has been dropped to avoid confusion and conflicts with the newer MISRA-C:2012 and the newer PC-Lint-Plus.</dd></dl>
<p>This release also includes the offline documentation for <b>this</b> particular version of QP-nano (in the <code>html/</code> folder). To view the offline documentation, open the file <code>html/index.html</code> in your web browser. (The online HTML documention for the <b>latest</b> version of QP-nano remains located at: <a href="https://www.state-machine.com/qpc/">https://www.state-machine.com/qpc/</a> )</p>
<p>Also, this release drops (no longer supports) the following depricated facilities from the <a class="el" href="qpn_8h.html" title="QP-nano public interface including backwards-compatibility layer.">qpn.h</a> header file:</p><ul>
<li>Q_ROM_VAR - just remove from your code</li>
<li>Q_RENTRANT - just remove from your code</li>
<li>QMSM_INIT() - use <a class="el" href="qepn_8h.html#ae080fd2c201a123d96842b7ca0290585" title="Polymorphically executes the top-most initial transition in a SM.">QHSM_INIT()</a> instead</li>
<li>QMSM_DISPATCH() - use <a class="el" href="qepn_8h.html#a2e708fffe790c6e2cce8b2be66094a4f" title="Polymorphically dispatches an event to a HSM.">QHSM_DISPATCH()</a> instead</li>
<li>QF_onIdle() - use <a class="el" href="qvn_8h.html#a105257e3c32a7e71b06648b741c6c120" title="QV idle callback (customized in BSPs for QK)">QV_onIdle()</a> instead</li>
<li><a class="el" href="qpn_8h.html#aa8c8e92285486066da120f694e53b155">QMsm_ctor()</a> - use <a class="el" href="qepn_8h.html#a3e1d1635d8a7f2247272bb425d8839b8" title="protected &quot;constructor&quot; of a HSM.">QHsm_ctor()</a> instead</li>
<li>QMsm_init() - use <a class="el" href="qepn_8h.html#ae080fd2c201a123d96842b7ca0290585" title="Polymorphically executes the top-most initial transition in a SM.">QHSM_INIT()</a> instead</li>
<li>QMsm_dispatch() - use <a class="el" href="qepn_8h.html#a2e708fffe790c6e2cce8b2be66094a4f" title="Polymorphically dispatches an event to a HSM.">QHSM_DISPATCH()</a> instead</li>
<li><a class="el" href="qpn_8h.html#a6e30f6e21cb7b9dae0ccb573c23ced4c">QMActive_ctor()</a> - use <a class="el" href="qfn_8h.html#a13edf5eeb78176195720ac88bf70b3ef" title="protected &quot;constructor&quot; of an QActive active object.">QActive_ctor()</a> instead</li>
<li>QMsm_init() - use <a class="el" href="qepn_8h.html#ae080fd2c201a123d96842b7ca0290585" title="Polymorphically executes the top-most initial transition in a SM.">QHSM_INIT()</a> instead</li>
<li>QActive_post() - use <a class="el" href="qfn_8h.html#ac41ac57f925509fc92f9b3612f8c03b5" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (task context).">QACTIVE_POST()</a> instead</li>
<li>QActive_postISR() - use <a class="el" href="qfn_8h.html#ae87ff71293fcaf377be03122512ef95e" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (ISR context).">QACTIVE_POST_ISR()</a> instead</li>
<li>QActive_arm() - use <a class="el" href="qfn_8h.html#adbc1b10b5546d6441a823da4867f4692" title="Arm the QP-nano one-shot time event.">QActive_armX()</a> instead</li>
<li>QActive_disarm() - use <a class="el" href="qfn_8h.html#acc54c1c6578d6cb53e2c8dd36370e3da" title="Disarm a time event.">QActive_disarmX()</a> instead</li>
<li>Q_TIMERSET - define QF_TIMEEVT_USAGE instead</li>
</ul>
<p>Also, this release updates the Windows-GUI examples with the QWIN Prototyping Toolkit to work with the latest Visual Studio 2019 and specifically with the Resource Editor now available. Specifically here, the Game-GUI example (qpn\examples\arm-cm\game_efm32-slstk3401a\win32-gui) and the DPP-GUI example (qpn\examples\arm-cm\dpp_efm32-slstk3401a\win32-gui) have been updated to build with the Visual Studio 2019.</p>
<p>Finally, this release fixes the following bugs:</p><ul>
<li><a href="https://sourceforg/bugs/255/">bug#255 "IAR-ARM "Multi-file Compilation" fails for QK and QXK applications"</a></li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_6_6_0"></a>
Version 6.6.0, 2019-10-31</h1>
<p>The main purpose of this release is the change in distribution of the QP-nano framework, which is now bundled together with the other QP frameworks (QP/C and QP/C++) as well as QM, and the QTools collection into "QP-bundle". This "QP-bundle" provides a single, streamlined and simplified download and installation of all QP frameworks and all the accompanying tools.</p>
<p>This release brings also the following changes:</p>
<ul>
<li>removed "//" (double slash) from all comments for compliance with the MISRA-C:2012 required Rule 3.1. (The "//" sequence was used in the URLs, such as "http://...").</li>
<li>converted inclusion guards in header files to uppercase as per coding convention for macros.</li>
<li>replaced "vtbl" with "vtable" in QP-nano source code</li>
<li>extended the range of <a class="el" href="qpn__conf_8h.html#a44b94e1d4ae451b6c67d6503999714a8" title="The size (in bytes) of the single scalar parameter representation in the QEvent struct.">Q_PARAM_SIZE</a> to 8 (8 corresponding to uint64_t)</li>
<li>fixed <a href="https://sourceforge.net/p/qpc/bugs/252/">bug#252 qassert.h used as standalone in qpn</a></li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_6_5_1"></a>
Version 6.5.1, 2019-06-11</h1>
<p>This release adds ports and examples for PIC24/dsPIC 16-bit MCUs with MPLAB-X and XC16 compiler toolchain.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_5_0"></a>
Version 6.5.0, 2019-03-30</h1>
<p>This QP-nano release matches the <a href="https://www.state-machine.com/qm/history.html#qm_4_5_0">QM release 4.5.0</a>, which introduced new implementation for QP/C++. Even though this has no impact on the QP-nano state machine implementation with QM, this release is needed for compatibility checking between QP and QM. This release comes with several models for <b>QM 4.5.0</b>.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_4_0"></a>
Version 6.4.0, 2019-02-10</h1>
<p>This release brings the following changes:</p>
<ul>
<li>added assertion to <a class="el" href="qepn_8h.html#ae080fd2c201a123d96842b7ca0290585" title="Polymorphically executes the top-most initial transition in a SM.">QHSM_INIT()</a> to make sure the the virtual-pinter (vptr) is initialized</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>These additional assertions require <a class="el" href="qassert_8h.html#a27042866331f49c9e9ff4f3ef459eaaf" title="Define the file name (with __FILE__) for assertions in this file.">Q_DEFINE_THIS_FILE</a> or <a class="el" href="qassert_8h.html#a302498d7d57ae4196cb0745ac65959ae" title="Define the user-specified module name for assertions in this file.">Q_DEFINE_THIS_MODULE</a> at the top of the .c file that calls <a class="el" href="qepn_8h.html#ae080fd2c201a123d96842b7ca0290585" title="Polymorphically executes the top-most initial transition in a SM.">QHSM_INIT()</a>.</dd></dl>
<ul>
<li>modified <a class="el" href="qassert_8h.html" title="Customizable and memory-efficient assertions for embedded systems.">qassert.h</a> to work correctly when assertions are disabled with <a class="el" href="macros_8h.html#a156525ce4ed9349b22aca5274d7cc432" title="The preprocessor switch to disable checking assertions.">Q_NASSERT</a> and also updated the QP/C source code to build correctly without assertions</li>
<li>modified Makefiles for workstations (Windows and POSIX) to use compiler options -std=c99 for C and -std=c++11 for C++ as well as -pedantic option.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_6_3_8"></a>
Version 6.3.8, 2018-12-31</h1>
<p>The main purpose of this release is the update the <code>Makefiles</code> that use the <a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm">GNU-ARM Embedded Toolchain</a> to match the recent update in <a href="https://sourceforge.net/projects/qpc/files/QTools/">QTools for Windows 6.3.8</a>. Specifically, all <code>Makefiles</code> in the <code>examples</code> directory have been updated to use the GNU-ARM toolchain located in <code>qtools\gnu_arm-none-eabi</code> and use the tools prefix <b>arm-none-eabi-</b>.</p>
<dl class="section note"><dt>Note</dt><dd>The <code>Makefiles</code> that use the GNU-ARM included in this release require <a href="https://sourceforge.net/projects/qpc/files/QTools/">QTools for Windows version 6.3.8 or newer</a> and will <b>NOT</b> work with the older QTools collection.</dd></dl>
<hr  />
 <h1><a class="anchor" id="qpn_6_3_7"></a>
Version 6.3.7, 2018-12-07</h1>
<p>The main purpose of this release is re-designing of the <a class="el" href="exa_os.html">examples for workstations</a> (previously <code>win32-qv</code> and <code>posix-qv</code>). All these types of examples have been consolidated in the <a class="el" href="exa_os.html">exampes/workstation</a> folder, where the provided <code>Makefiles</code> have been extended to be cross-platform so that they work on Windows, Linux, and MacOS without changes. To facilitate the creation of truly portable, cross-platform examples, the existing <a class="el" href="ports_os.html">QP ports to Windows/POSIX</a> have been augmented with abstractions for portable console access.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_3_3"></a>
Version 6.3.3, 2018-06-22</h1>
<p>This release fixes the following bugs:</p>
<ul>
<li><a href="https://sourceforge.net/p/qpc/bugs/218/">bugs:#218 "__flash attribute in avr port"</a></li>
<li><a href="https://sourceforge.net/p/qpc/bugs/216/">bug#216 "Generated code for QP version check violates MISRA-C Rule 10.1"</a>.</li>
<li><a href="https://sourceforge.net/p/qpc/bugs/217/">bug#217 "GNU-ARM -fstack-protector incompatible with the QP ports to GNU-ARM"</a>.</li>
<li><a href="https://sourceforge.net/p/qpc/bugs/215/">bug#215 "QP is internally inconsistent in calling assertion macros"</a>.</li>
</ul>
<p>Also, this release demonstrates the new features of QM 4.3.0 in several example models (qpn/examples/ directory).</p>
<p>Finally, this release updates <code>3rd_party/CMSIS/Include</code> to the latest version from GitHub.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_3_0"></a>
Version 6.3.0, 2018-05-10</h1>
<p>This release improves the command-line scripts for flash programming of the supported MCUs. Specifically, the flash.bat batch files for EFM32-SLSTK3401A, EK-TM4C123GXL, and for Arudino UNO have been updated.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_2_0"></a>
Version 6.2.0, 2018-03-16</h1>
<p>This release updates the QP-nano ports to win32-qv and posix-qv to allow a "tickless" mode, where the "tickerThread" is not created. This mode is set by configuring the system clock tick rate to 0 (QF_setTickRate(0)).</p>
<p>Additionally, this revision updates the posix-qv port implementation to wait for the condition variable in a customary wile() loop.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_1_1"></a>
Version 6.1.1, 2018-02-18</h1>
<p>The main purpose of this release is adding the context-switch callback to the preemptive <a class="el" href="group__qkn.html">QK-nano</a> kernel. The <a class="el" href="qkn_8h.html#a11f4579e86b873a1e40179e7e5ab2959" title="QK-nano context switch callback (customized in BSPs for QK-nano)">QK_onContextSw()</a> callback function provides a mechanism to perform additional custom operations when QK switches context from one thread to another. To avoid extra overhead when this functionality is not needed and for backwards-compatiblity with the existing applications, the callback is enabled only when the macro <a class="el" href="qkn_2qfn__port_8h.html#a606cc116164e722ae952c031623fe6d1" title="Macro that enables context-switch callback in QK-nano.">QK_ON_CONTEXT_SW</a> is defined. The macro can be defined either directly in command-line for the compiler, or in the QK-nano port file (qpn_port.h). Examples for the context-switch callbacks have been provided for the <a class="el" href="arm-cm_dpp_nucleo-l053r8.html">NUCLEO-L053R8</a> (Cortex-M0+) and the <a class="el" href="arm-cm_dpp_ek-tm4c123gxl.html">EK-TM4C123GXL</a> (Cortex-M4F).</p>
<p>Another purpose of this release is adding the support for the <a href="https://developer.arm.com/products/software-development-tools/compilers/arm-compiler"><b>ARM Compiler 6 (ARM-Clang)</b></a>, which is a C/C++ toolchain for ARM processors based on the modern <a href="https://clang.llvm.org/">Clang frontend</a> and the <a href="https://llvm.org/">LLVM framework</a>. This release adds the ARM-Clang ports and examples for all built-in kernels (QV-nano and QK-nano) for the ARM Cortex-M CPU cores.</p>
<p>Also, this release changes the ARM Cortex-M ports for the IAR-ARM toolchain in that it replaces the assembly modules with the equivalent C implementation. All existing example projects for IAR-ARM have been updated to use the <code>qkn_port.c</code> files instead of <code>qkn_port.s</code> files.</p>
<p>Also, this release adds new project files for the Atollic TRUEstudio for STM32. The TRUEstudio projects (Eclipse) have been added for the <a class="el" href="arm-cm_dpp_nucleo-l053r8.html">NUCLEO-L053R8</a> (Cortex-M0+) and the <a class="el" href="arm-cm_dpp_nucleo-l152re.html">NUCLEO-L152RE</a> (Cortex-M3).</p>
<p>Finally, this relese updates the CMSIS to version 5.3.0 (see <code>qpn/3rd_party/CMSIS</code></p>
<hr  />
 <h1><a class="anchor" id="qpn_6_0_4"></a>
Version 6.0.4, 2018-01-10</h1>
<p>This release replaces assembly with C implementation in the ARM-KEIL ports or the QK-nano kernel to Cortex-M to take advantage of the <code>__asm</code> functions. (NOTE: this change has impact on the existing QP-nano applications that use the ARM-KEIL toolchain and the QK kernel.)</p>
<p>Also, this release adds an example of the Dining Philosophers Problem (DPP) re-designed with the <a href="https://www.state-machine.com/doc/Pattern_Orthogonal.pdf">"Orthogonal Component" state pattern</a>. The application uses only one active object (Table), while the Philos are stateful components of Table. The example is located in <code>qpn\examples\win32-qv\dpp_comp</code>.</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_0_3"></a>
Version 6.0.3, 2017-12-12</h1>
<p>This release replaces attributes of <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a> class and <a class="el" href="qfn_8h.html#a4c9ee418dab7af7004cfd9ebbb5bc8f5" title="type of the Time Event counter, which determines the dynamic range of the time delays measured in clo...">QTimeEvtCtr</a> type from type uint_fast8_t to uint8_t. For the ARM Cortex-M port, these changes reduce the memory footprint of each <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a> instance from 40 to 26 bytes (35% improvement).</p>
<p>Also, the ARM Cortex-M port and examples for the TI-ARM compiler have been removed. (Projects for the TI CCS can use the GNU-ARM toolchain and the existing GNU-ARM ports).</p>
<hr  />
 <h1><a class="anchor" id="qpn_6_0_1"></a>
Version 6.0.1, 2017-11-10</h1>
<p>This release includes a workaround for the GNU-ARM compiler bug for the ARMv6-M architecture (Cortex-M0/M0+/M1), which can lead to generation of incorrect code for the QP-nano critical section at certain gcc optimization levels (such as -O). This bug was first discovered and filed as <a href="https://sourceforge.net/p/qpc/bugs/184/">bug#184</a>. The bug affected the GNU-ARM ports to both built-in kernels <a class="el" href="group__qvn.html">QV-nano</a> and <a class="el" href="group__qkn.html">QK-nano</a>.</p>
<dl class="section attention"><dt>Attention</dt><dd>This release no longer contains the directory <code>qpn/source</code>, which was scheduled to be phased out in QP5. In QP6 the source code is found only in the <code>qpn/src</code> directory.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This QP-nano 6.0.1 release is the minimum version required in the upcoming QM 4.1.0.</dd></dl>
<hr  />
 <h1><a class="anchor" id="qpn_5_9_8"></a>
Version 5.9.8, 2017-09-15</h1>
<p>This release implements the feature request <a href="https://sourceforge.net/p/qpc/feature-requests/126/" target="_blank" class="extern">#126</a> "Allow non-asserting
event posting for zero-margin allocations". Specifically, calling ACTIVE_POST_X() and ACTIVE_POST_X_ISR() with the margin argument of zero will no longer assert if the allocation/posting fails. The asserting version is these macros uses the special value of the <code>margin</code> argument of <a class="el" href="qfn_8h.html#a3c1957439cb1ecff92be7b7401bf3159" title="special value of margin that causes asserting failure in case event posting fails.">QF_NO_MARGIN</a>.</p>
<p>Improved comments in the soruce code.</p>
<p>Modifed ARM Cortex-M examples with the GNU-ARM toolset to be consistent with QP/C++ (support for RTTI and C++ Exception handling), as follows:</p>
<ul>
<li>removed definitions of <code>_init()</code> and <code>_fini()</code> from the GNU-ARM startup code for all supported boards in the <code>3rd_party</code> directory</li>
<li>commented out the call to <code>__libc_init_array()</code> in the GNU-ARM startup code for all supported boards in the <code>3rd_party</code> directory (because it requires <code>_init()</code>)</li>
<li>Modified all GNU-ARM linker scripts (.ld files) to add the following symbols:</li>
</ul>
<pre class="fragment">   __exidx_start = .;
   .ARM.exidx   : { *(.ARM.exidx* .gnu.linkonce.armexidx.*) } &gt;RAM
   __exidx_end = .;
</pre><hr  />
 <h1><a class="anchor" id="qpn_5_9_7"></a>
Version 5.9.7, 2017-08-18</h1>
<p>This release phases out the QK-nano mutex and replaces it with an equivalent selective QK-nano scheduler locking up to the specified ceiling priority. Specifically, this feature has been implemented with two new operations <a class="el" href="qkn_8h.html#a6d638caae0fbbaf0c0912e78205525c6" title="QK Scheduler lock.">QK_schedLock()</a> and <a class="el" href="qkn_8h.html#ad16b86d19848aa52a704b514c96373fa" title="QK Scheduler unlock.">QK_schedUnlock()</a>. This is done with consistency with the QK and QXK kernels in QP/C/C++. The advantage of the new implementation is also the ability of the scheduler locks to nest, which was not the case with the QK-nano mutex.</p>
<p>All related QK-nano examples have been updated to use the selective scheduler locking instead of the mutex. The new blocking QXK mutex has been demonstrated in the following updated examples:</p><ul>
<li><a class="el" href="arm-cm_dpp_efm32-slstk3401a.html">DPP on EFM32-SLSTK3401A</a></li>
<li><a class="el" href="arm-cm_dpp_ek-tm4c123gxl.html">DPP on EK-TM4C123GXL</a></li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>The changes to QK-nano <b>break backwards-compatibly</b> with the existing code that relies these features. In the existing code, the mutexes should be replaced with selective scheduler locking.</dd></dl>
<p>This release also updates CMSIS to version 5.1.0 (3rd_party/CMSIS).</p>
<p>This release also adds the <a class="el" href="api.html">API Reference</a> section to the QP-nano documentation.</p>
<hr  />
 <h1><a class="anchor" id="qpn_5_9_6"></a>
Version 5.9.6, 2017-08-04</h1>
<p>This release changes the organization of the QP-nano source code to make it more friendly for the Eclipse CDT, as proposed in the <a href="https://sourceforge.net/p/qpc/feature-requests/123/" target="_blank" class="extern">feature request #123 "Eclipse-friendly source directory structure for QP"</a>. Specifically, the QP-nano source code is now provided in the <code>qpn/src/</code> directory with the following structure:</p>
<pre class="fragment">qpn\
  +-source\  - exitsting source directory with "flat" structure
  |            (for backwards-compatibility)
  +-src\     - new source directory grouped by functionality
     +-qfn\  - core framework (QEP-nano + QF-nano)
     +-qkn\  - QK-nano kernel
     +-qvn\  - QV-nano kernel
</pre><p>This release consistently changes all example projects (for all toolchains) to use the <b>src/</b> directory for QP-nano source code, instead of the <b>source/</b> directory.</p>
<dl class="section note"><dt>Note</dt><dd>The original <code>qpn/source</code> directory is still provided for backwards compatibility with the existing QP-nano projects. This directory will be phased out in the future QP-nano releases. Please use the new source code structure provided in the <code>qpn/src</code> directory.</dd></dl>
<p>Finally, this release adds protection in the IRQ priorities initialization in QK-nano/QV-nano for ARM Cortex-M3/M4/M7, so that the number of IRQs is extracted from bits 0-2 of the ICTR register (INTLINESNUM).</p>
<hr  />
 <h1><a class="anchor" id="qpn_5_9_5"></a>
Version 5.9.5, 2017-07-20</h1>
<p>This release fixes the following bug:</p><ul>
<li><a href="https://sourceforge.net/p/qpc/bugs/178/" class="extern">bug#178</a> "GNU-ARM compiler reports "Error: unaligned opcodes..." in startup code for QP/C/C++/nano examples". The bug fix entails modifying the startup code for the GNU-ARM compiler in the <code>3rd_party</code> directory. Specifically, the proper alignment directives have been added to the inline assembly in the exception handlers.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_5_9_3"></a>
Version 5.9.3, 2017-07-03</h1>
<p>This release fixes the following bugs:</p>
<ul>
<li>bug#176 "Incorrect initialization of PendSV interrupt priority in
QK-nano for ARM Cortex-M0/M0+" (<a href="https://sourceforge.net/p/qpc/bugs/176/">https://sourceforge.net/p/qpc/bugs/176/</a>)</li>
<li>bug#162 "QF critical sections require modification for M7 core" <a href="https://sourceforge.net/p/qpc/bugs/162/">https://sourceforge.net/p/qpc/bugs/162/</a></li>
</ul>
<p>Additionally, this release adapts the Makefiles for GNU-ARM to the new location of the GNU-ARM toolset, which is now included in the QTools Collection (v 5.9.1) for Windows.</p>
<p>This release also upgrades CMSIS to version 5.0.2.</p>
<hr  />
 <h1><a class="anchor" id="qpn_5_8_2"></a>
Version 5.8.2, 2017-02-08</h1>
<p>This release improves compatibility of assertion numbering between QP-nano and QP/C/C++. Specifically, <a class="el" href="qepn_8c.html" title="QEP-nano implementation.">qepn.c</a> file now uses the same assertion-IDs as qep_hsm.c (QP/C) and qep_hsm.cpp (QP/C++).</p>
<p>This release upgrades CMSIS to version 5.0.1.</p>
<p>Finally, this release fixes the following bugs:</p><ul>
<li>bug#152 Typo (qpc\ports\arm7-9\qk\gnu\qk_port.s:42) prevents compilation</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_5_8_1"></a>
Version 5.8.1, 2016-12-16</h1>
<p>This release is in response to a recent finding that many QP users of the ports to ARM Cortex-M3/M4 forget to explicitly set their interrupt priorities, as described in the AppNote <a href="https://www.state-machine.com/doc/AN_ARM-Cortex-M_Interrupt-Priorities.pdf" target="_blank" class="extern">"Setting ARM Cortex-M Interrupt Priorities in QP 5.x"</a>.</p>
<p>Specifically, this release improves safety of QP ports to ARM Cortex-M3/M4, by initializing the interrupt priorities to a safe default in a generic, portable way. This QP port includes such a fix for QV-nano/QK-nano ports to ARM Cortex-M3/M4.</p>
<p>Changes in detail:</p><ul>
<li>modified the QV and QK source code to call <a class="el" href="qvn_2qfn__port_8h.html#ab5352be34920bbaac36cba99ae5c13e7">QV_init()</a> and <a class="el" href="qkn_2qfn__port_8h.html#ae1fa4705c311e29699a0164a20362bf1">QK_init()</a>, respectively.</li>
<li>modified the ARM Cortex-M ports of QV-nano and QK-nano to initialize priorities all exceptions and IRQs to the safe value #QF_BASEPRI.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The QV-nano ports to ARM Cortex-M now have a new <b>qvn_port.c</b> module that needs to be added to the build.</dd></dl>
<ul>
<li>added the header file <b>cmsis_ccs.h</b> to qpc/3rd_party/CMSIS/Include directory (used in the examples for the Code Composer Studio). The file has been dropped during the upgrade to CMSIS 5.0.1, because it is not part of the standard distribution.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_5_8_0"></a>
Version 5.8.0, 2016-11-07</h1>
<p>This release simplifies the QP-nano framework by removing the QMsm-style state machine implementation strategy introduced in version 5.0.0. Moving forward, the only supported state machine implementation strategy in QP-nano will be the QHsm-strategy and the upcoming QM 4.x will provide only the QHsm-strategy for QP-nano applications.</p>
<p>Specifically, the QMsm base class, and QMActive base class have been removed, along with the accompanying macros. The QP-nano compatibility layer (file <a class="el" href="qpn_8h.html" title="QP-nano public interface including backwards-compatibility layer.">qpn.h</a>) provides some of these macros for backwards- compatibility, but the underlying implementation must be, in fact, based on <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a>.</p>
<p>All examples and QM models have been updated to use only the QHsm-style implementation strategy. The models also require the new upcoming QM 4.0.0.</p>
<p>Additionally, this release fixes the following bugs:</p>
<p>-bug#144 Obsolete Win32 API in qwin_gui.c</p>
<p>Finally, this release includes the latest CMSIS-5, which now replaces the older CMSIS-4.5.</p>
<hr  />
 <h1><a class="anchor" id="qpn_5_7_3"></a>
Version 5.7.3, 2016-10-07</h1>
<p>This release fixes the following bugs:</p><ul>
<li>bug#140 (PendSV_Handler() exception stacked PC not halfword aligned).</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_5_7_2"></a>
Version 5.7.2, 2016-09-30</h1>
<p>This release changes the internal QK-nano implementation to match the QK kernel implementation used in QP/C and QP/C++. (e.g., <a class="el" href="qkn_8h.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK-nano scheduler finds the highest-priority thread ready to run.">QK_sched_()</a> has been renamed to <a class="el" href="qkn_8h.html#a57768dcdb71b3e41f329bae839584399" title="QK activator activates the next active object.">QK_activate_()</a> and QK_schedPrio_() to <a class="el" href="qkn_8h.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK-nano scheduler finds the highest-priority thread ready to run.">QK_sched_()</a>). These changes fall into the category of refactoring and have no impact on the API or performance.</p>
<hr  />
 <h1><a class="anchor" id="qpn_5_7_0"></a>
Version 5.7.0, 2016-08-31</h1>
<p>This release release changes once more the QK-nano port to ARM Cortex-M, to reduce the interrupt latecy. This has been achieved by shortening the critical section in the PendSV exception. Also, this QK port to Cortex-M no longer uses the NMI exception.</p>
<p>Finally, this release replaces all absolute paths with relative paths in all CCS-Eclipse project files (for TivaC, Hercules, and MSP430).</p>
<hr  />
 <h1><a class="anchor" id="qpn_5_6_5"></a>
Version 5.6.5, 2016-06-09</h1>
<p>This release adds support for the new board: EFM32-SLSTK3401A (Pearl Gecko Starter Kit from Silicon Labs). This board replaces the Stellaris EK-LM3S811 board, which has been discontinued. (The Stellaris EK-LM3S811 board had been used in the "Fly 'n' Shoot" game example accompanying the PSiCC2 book).</p>
<p>This release also introduces a new version of the QWIN GUI Toolkit in the Windows prototypes for the "Fly 'n' Shoot" game and the DPP-GUI version (see <a href="https://www.state-machine.com/products/index#QWIN">https://www.state-machine.com/products/index#QWIN</a>).</p>
<p>Additionally, this release also includes the QP-nano integration with the emWin emgedded GUI from SEGGER, which is also the same product as uC/GUI distributed by Micrium (exa_emwin).</p>
<p>Finally, this relase comes with updated project files for TI Code Composer Studio (both for ARM Cortex-M and for MSP430).</p>
<p>This release fixes the following bugs:</p><ul>
<li>bug#130 (POSIX port stop-&gt;start leads to reuse of sestroyed mutex).</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_5_6_4"></a>
Version 5.6.4, 2016-04-25</h1>
<p>This release fixes two serious bugs:</p><ul>
<li>Bug #126 (<a href="https://sourceforge.net/p/qpc/bugs/126">https://sourceforge.net/p/qpc/bugs/126</a> ) in the QK preemptive scheduler introduced in QP 5.6.2.</li>
<li>Bug #128 (<a href="https://sourceforge.net/p/qpc/bugs/128">https://sourceforge.net/p/qpc/bugs/128</a> ) in the QK port to ARM Cortex-M introduced back in QP 5.6.1</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_5_6_2"></a>
Version 5.6.2, 2016-04-06</h1>
<p>The main purpose of this release is to eliminate the need to define the QF_MAX_ACTIVE macro (the number of active objects) in <a class="el" href="qpn__conf_8h.html" title="QP-nano configuration file.">qpn_conf.h</a> header file and match it with the dimension of the QF_active[] global array.</p>
<p>Instead, starting with this QP-nano version, the dimension of the QF_active[] array can be passed as the argument to the <a class="el" href="qfn_8h.html#a1e56e284f4f0336a56f5ea8e6520295e" title="QF-nano initialization.">QF_init()</a> function, as follows: QF_init(Q_DIM(QF_active));</p>
<dl class="section note"><dt>Note</dt><dd>For backwards compatibility the QF_MAX_ACTIVE macro, if defined, is still recognized and calling QF_init(Q_DIM(QF_active)) from main() is not necessary.</dd></dl>
<p>Changes in detail:</p>
<ol type="1">
<li>Added internal variable QF_maxActive_ to store the number of active objects and replaced all occurrences of QF_MAX_ACTIVE with it.</li>
<li>Moved the implementation of <a class="el" href="qfn_8h.html#a1e56e284f4f0336a56f5ea8e6520295e" title="QF-nano initialization.">QF_init()</a> from qfn_init.c to <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> and changed it to take the maxActive argument.</li>
<li>Eliminated the source file qfn_init.c.</li>
<li>Modified the POSIX-QV port to use the new initialization strategy</li>
<li>Modified the WIN32-QV port to use the new initialization strategy</li>
<li>Removed the macro QF_MAX_ACTIVE from all examples and added call to QF_init(Q_DIM(QF_active)) instead.</li>
<li>Fixed the 3rd-party file startup_stm32l32l1xx.c to include exceptions for Cortex-M3 (MemManage_Handler, BusFault_Handler, and UsageFault_Handler).</li>
<li>Updated the 3rd-party files for the EK-TM4C123GXL board (TivaC LaunchPad).</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_6_1"></a>
Version 5.6.1, 2016-01-11</h1>
<p>This QP-nano release provides a new version of the QK-nano ports to ARM Cortex-M, which do not use the SVC_Handler (Supervisor Call). This is done to make the QK-nano ports compatible with various "hypervisors" (such as mbed uVisor or Nordic SoftDevice), which use the SVC exception. This release contains the updated QK-nano ports to ARM Cortex-M for all supported compilers: ARM-Keil, GNU-ARM, IAR EWARM, and TI-CCS-ARM.</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Modified the ARM Cortex-M QK-nano ports to not use the SVC_Handler.</li>
<li>Modified the GNU-ARM ports of QK for ARM Cortex-M, to use the __ARM_ARCH macro to distinguish among different architectures (ARCHv6 vs ARCHv7).</li>
<li>Added error directives to source files from different built-in kernels (QV and QK) to generate meaningful error messages when these files are mixed in one project. For example, a project based on QV will report errors when source files for QK-nano are included in it.</li>
<li>Updated CMSIS from 4.2 to 4.3 in qpn/3rd-party/CMSIS</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_5_1"></a>
Version 5.5.1, 2015-10-06</h1>
<p>This release adds state machine operations for implementing the shallow history mechanism. The operations are called QMsm_childStateObj() and <a class="el" href="qepn_8h.html#a434a5cd00fba47995e605d6ad7ba3317" title="Obtain the current active child state of a given parent in QHsm.">QHsm_childState()</a>, for QMsm and <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> classes, respectively, because they compute a child state of a given parent, such that the child belongs to the same state hierarchy as the current state.</p>
<p>This release also improves the AAPCS compliance of the ARM Cortex-M port to the QK preemptive kernel. Specifically, the PendSV handler in assembly did not always maintain the 8-byte stack alignment, which is required by AAPCS. This version corrects the stack misalignment in the qk_port.s files for all supported ARM compilers (ARM-Keil, GNU, IAR, and TI CCS). All these ports should also be ready for ARM Cortex-M7.</p>
<p>Also, this release adds support for the TI CCS ARM compiler. Specifically, a new ARM Cortex-M ports have been added (in directories <code>qpn\ports\arm-cm\qk\ti\</code> and <code>qpn\ports\arm-cm\qk\ti\</code>) and TI CCS example projects have been provided (in directories <code>qpn\examples\arm-cm\dpp_ek-tm4c123gxl\qk\ti\</code> and <code>qpn\examples\arm-cm\dpp_ek-tm4c123gxl\qv\ti\</code>).</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Added the new prototypes QMsm_childStateObj() and <a class="el" href="qepn_8h.html#a434a5cd00fba47995e605d6ad7ba3317" title="Obtain the current active child state of a given parent in QHsm.">QHsm_childState()</a> to <a class="el" href="qepn_8h.html" title="Public QEP-nano interface.">qepn.h</a></li>
<li>Added implementation of QMsm_childStateObj() and <a class="el" href="qepn_8h.html#a434a5cd00fba47995e605d6ad7ba3317" title="Obtain the current active child state of a given parent in QHsm.">QHsm_childState()</a> to <a class="el" href="qepn_8c.html" title="QEP-nano implementation.">qepn.c</a></li>
<li>Modified the qk_port.s assembly implementation for all supported ARM Cortex-M toolsets (ARM-Keil, GNU, IAR, and TI CCS)</li>
<li>Added QP-nano Cortex-M port to TI CCS.</li>
<li>Added CCS example projects in <code>qpn\ports\arm-cm\qk\ti\</code> and `qpn\ports\arm-cm\qk\ti\</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_4_2"></a>
Version 5.4.2, 2015-06-07</h1>
<p>The main focus of this release is to improve the support for "dual targeting" of QP-nano applications, which is developing of deeply embedded code as much as possible on the desktop OS, such as Windows. Experience shows that "dual targeting" dramatically improves productivity of embedded systems developers, perhaps more than any other technique.</p>
<p>This release makes it possible to use exactly the <b>same</b> application code, main function, and the Board Support Package interface (bsp.h) on both deeply embedded target and on Windows. The only differences between these targets can be completely encapsulated in the Board Support Package implementation (bsp.c).</p>
<p>The support for "dual targeting" in this QP-nano release works both for Win32 console and Win32 GUI applications. The Win32-GUI support enables developers to easily emulate the front-panels of the embedded devices, with LCD-screens (graphical and segmented), LEDs, buttons, switches, sliders, etc.</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Modified the QP-nano port to Windows (<a class="el" href="win32-qv.html">Win32-QV</a>) so that it supports both Win32 console and Win32-GUI applications. The newly introduced pre-processor <a class="el" href="macros_8h.html#a8f79859d1e9f6f0a55e722dfe573c547" title="Macro that should be defined (typically on the compiler&#39;s command line) in the Win32-GUI applications...">WIN32_GUI</a> macro is now required to use the Win32-GUI facilities.</li>
<li>Added portable "safe" macros from <code>&lt;stdio.h&gt;</code> and <code>&lt;string.h&gt;</code> to the QP-nano port to Windows. These macros encapsulate the differences between Microsoft Visual C++ and other compilers (such as MinGW).</li>
<li>Simplified the structure of the QP-nano Windows port by eliminating one level of directories for the compilers used. Both VC++ and MinGW builds can now be run in the same port directory.</li>
<li>Modified the <a class="el" href="qfn_8h.html#adf9cb86740bf55c5ad55c1d44fd35921" title="QF-nano termination.">QF_stop()</a> function in the QP-nano port to <a class="el" href="win32-qv.html">Win32-QV</a>, so that it unblocks the QV event-loop and thus lets the application terminate.</li>
<li>Modified all examples for Windows to use the new port structure.</li>
<li>Improved all Makefiles (for the MinGW toolset) in all Windows examples, to make them easier to adapt to custom applications, both Win32 console and Win32 GUI.</li>
<li>Moved several examples from the <code>examples/win32/</code> and examples/win32-qv directories to <code>examples/arm-cm/</code> directory with native embedded examples for ARM Cortex-M. This co-location of the Win32 emulation with the embedded code running on the actual board demonstrates better the "dual targeting" development approach.</li>
<li>Made the <a class="el" href="qfn_8h.html#struct_q_active_c_b" title="QActive Control Block.">QActiveCB</a> (<a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a> Control Block) to the QP-nano backwards-compatibility layer as deprecated. Instead, the newer QP-nano applications should use <a class="el" href="qpn_8h.html#a5efd93351bb724af9a84a3968d39c898">QMActiveCB</a>.</li>
<li>Updated all Windows examples to the latest QP API by compiling the code with the macro <a class="el" href="qpn_8h.html#a3d046e1bb0df20880186bd32a31684f0" title="Macro that specifies the backwards compatibility with the QP-nano API version.">QP_API_VERSION</a> set to 9999 (latest API without backwards compatibility)</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_4_0"></a>
Version 5.4.0, 2015-05-31</h1>
<p>This release changes the basic philosophy of packaging and distributing the QP-nano framework by <b>combining</b> the "QP-nano Baseline Code" with all currently available "QP-nano Development Kits" (QDK-nano). This is done to eliminate any potential mistakes in downloading and installing separate pieces of code.</p>
<p>This release also changes the active object class hierarchy so that <a class="el" href="qpn_8h.html#acb6eee6e3b8577f256e4c8de9619e19c">QMActive</a> is now more fundamental and is the base class for <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a>. (Previously <a class="el" href="qpn_8h.html#acb6eee6e3b8577f256e4c8de9619e19c">QMActive</a> was a subclass of <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a>). The newly added documentation section about <a class="el" href="struct.html#classes">QP-nano Design</a> shows the current class hierarchy.</p>
<dl class="section note"><dt>Note</dt><dd>Because the types <a class="el" href="qpn_8h.html#acb6eee6e3b8577f256e4c8de9619e19c">QMActive</a> and <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a> are equivalent in QP-nano, this change has minimal impact on the applications, but it is now more correct to use <a class="el" href="qpn_8h.html#acb6eee6e3b8577f256e4c8de9619e19c">QMActive</a> as the base class for all "opaque" active object pointers.</dd></dl>
<p>Additionally, this release alignes the QP-nano framework better with the rest of the QP framework family (QP/C and QP/C++), so that fewer changes are needed to move applications between QP-nano and QP/C.</p>
<p>Finally, this release adds periodic time events (timers) to QP-nano. The feature is demonstrated by many provided examples (e.g., "Blinky", "Fly 'n' Shoot" game, PELICAN crossing).</p>
<p>The aforementioned changes have also the following ripple effects:</p>
<ol type="1">
<li>The structure of the QP-nano ports has been modified to match QP/C and to avoid repetitions. The QP-nano application no longer need to provide and #include the complete port <code>qpn_port.h</code> header file, which is now deprecated. Insted QP-nano application code needs to #include the <span class="img file_h"><a class="el" href="qpn_8h.html" title="QP-nano public interface including backwards-compatibility layer.">qpn.h</a></span> (QP-nano API) header file, which also now contains the QP-nano backwards-compatibility layer.</li>
<li>The application is now only responsible for providing the <span class="img file_h"><a href="qpn__conf_8h.html"><b>qpn_conf.h</b></a></span> file to set up the basic configuration for QP-nano. Examples of the <code>qpn_config.h</code> configurations are provided in all supplied QP-nano examples.</li>
<li>The actual port (e.g., the interrupt disabling policy for tasks and interrupts, interrupt entry/exit code, etc.) is included from the <span class="img folder"><a class="el" href="ports.html">Ports</a></span> folder. This <span class="img folder"><a class="el" href="ports.html">Ports</a></span> folder has been reorganized to contain all currently available QP-nano ports. The ports are organized into two categories: <a class="el" href="ports_native.html">native QP-nano ports</a> ("bare-metal") and <a class="el" href="ports_os.html">ports to big operating systems</a> (Windows and Linux).(<b>NOTE</b>: the ports are now documented in the this <b>QP-nano Reference Manual</b>. Each port sub-directory contains a <span class="img qp_link">README</span> link to the corresponding page in the online documentation)</li>
<li>Expanded the QP-nano time events (timers) with the ability to fire periodically. The feature is controlled by the preprocessor switch <a class="el" href="qpn__conf_8h.html#ad4ea1b1416a93ac72df4b63182920979" title="Configuration switch to enable/disable periodic time events.">QF_TIMEEVT_PERIODIC</a>. When this macro is defined (in the <code>qpn_config.h</code> header file), the signature of the <a class="el" href="qfn_8h.html#adbc1b10b5546d6441a823da4867f4692" title="Arm the QP-nano one-shot time event.">QActive_armX()</a> function contains one more <code>interval</code> parameter. The <code>interval</code> parameter allows you to specify the interval of the periodic timeout. If the <code>interval</code> is zero, the time event is one-shot.</li>
<li>It is no longer necessary to define the <b>QPN environment variable</b> to build the QP-nano examples. All directories and files referenced by example projects are <b>relative</b> to the project folder. This change reflects the fact that most development tools add source files to the project using relative paths.</li>
<li>The QP-nano <span class="img folder"><a class="el" href="exa.html">Examples</a></span> folder has been reorganized to reduce the repetitions and contains all currently available QP-nano examples. The folder includes four categories of examples: <a class="el" href="exa_native.html">native QP-nano examples</a> ("bare-metal") and <a class="el" href="exa_os.html">examples for big operating systems</a> (Windows and Linux). The <span class="img folder">examples</span> folder has been expanded to contain all currently available QP-nano examples, many of them are new in this release. (<b>NOTE</b>: the currently available examples are now documented in the <b>QP-nano Reference Manual</b>. Each example sub-directory contains a <span class="img qp_link">README</span> link to the corresponding page in the online documentation)</li>
<li>A new <span class="img folder">3rd_party</span> folder created to contain the Third-Party code used in the QP-nano ports and examples, such as MCU register files, low-level startup code, device drivers, etc. The <span class="img folder">3rd_party</span> folder avoids the need to repeat such code in every project. Also, the separation of the Third-Party components helps to clearly indicate code that comes from various sources, and to which Quantum Leaps, LLC expressly makes <b>no claims of ownership</b>. The Third-Party software components included in this "3rd_party" folder are licensed under a variety of different licensing terms that are defined by the respective owners of this software and are spelled out in the README.txt or LICENSE.txt files included in the respective sub-folders.</li>
<li>This release also comes with the much expanded online <b>QP-nano Reference Manual</b>, which is cross-linked with the ports and examples.</li>
</ol>
<p>Changes in detail:</p>
<ol type="1">
<li>Renamed the "Vanilla" scheduler to the <a class="el" href="struct.html#comp_qv">QV-nano cooperative kernel</a> for symmetry with the <a class="el" href="struct.html#comp_qk">QK-nano preemptive kernel</a>. Renamed QF_onIdle() callback to <a class="el" href="qvn_8h.html#a105257e3c32a7e71b06648b741c6c120" title="QV idle callback (customized in BSPs for QK)">QV_onIdle()</a>.</li>
<li>Removed class ::QFsm (which is now deprecated). Legacy state machines coded in the "QFsm-style" will continue to work, but will use the <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> implementation internally. There is no longer any efficiency advantage in using the "QFsm-style" state machines.</li>
<li>Updated <a class="el" href="exa_arm-cm.html">ARM Cortex-M examples</a> and provided new examples for NXP mbed-LPC1768, and STM32 NUCLEO-L053R8, and NUCLEO-L152RE boards. All examples now use the latest CMSIS (V4.3.0). All ARM Cortex-M exampels are provided for the ARM-KEIL, GNU-ARM, and IAR-ARM toolsets.</li>
<li>Added the native <a class="el" href="arm7-9.html">port</a> and <a class="el" href="exa_arm7-9.html">examples</a> to the <a class="el" href="arm7-9.html">classic ARM7/9</a> with AT91SAM7S-EK board and the IAR-ARM toolset.</li>
<li>Added the native <a class="el" href="avr.html">port</a> and <a class="el" href="exa_avr.html">examples</a> to the AVR (AVRmega) with GNU-AVR and IAR-AVR toolsets. The <a class="el" href="exa_avr.html">examples</a> are provided for the Arduino-UNO board.</li>
<li>Added the native <a class="el" href="msp430.html">port</a> and <a class="el" href="exa_msp430.html">examples</a> to MSP430 with TI CCS-430 and IAR-430 toolsets. The <a class="el" href="exa_msp430.html">examples</a> are provided for the MSP430 LauchPad boards (the MSP-EXP430G2 and MSP-EXP430F5529LP for the "classic" MSP430 and "extened" MSP430X, respectively).</li>
<li>Updated <a class="el" href="win32-qv.html">port to Win32-QV</a> (Windows with cooperative "Vanilla" scheduler, previously known as Win32-1T). Modified the port to apply a "fudge factor" in over-sizing QP-nano event queues and event pools, to minimize the risk of overflowing queues/pools due to non-deterministic Windows behavior.</li>
<li>Renamed the POSIX port to <a class="el" href="posix-qv.html">POSIX-QV</a> (POSIX with cooperative "Vanilla" scheduler). Modified the port to apply a "fudge factor" in over-sizing QP-nano event queues and event pools, to minimize the risk of overflowing queues/pools due to non-deterministic behavior under POSIX.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_3_0"></a>
Version 5.3.0, 2014-04-18</h1>
<p>This release adds the "transition to history" (deep history) feature to both <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> and QMsm state machines and their subclasses. This QP-nano release matches the new QM modeling tool Version 3.1.0, which now supports the "transition to history" connector and the corresponding code generation for transitions to history.</p>
<dl class="section note"><dt>Note</dt><dd>QP-nano 5.3.0 breaks backwards-compatibility with QP-nano applications developed for QP-nano 4.x and 5.x. However, the update to QP-nano 5.3.0 typically requires only to add #include &lt;<a class="el" href="stdbool_8h.html" title="Boolean type and constansts. WG14/N843 C99 Standard, Section 7.16.">stdbool.h</a>&gt; and #include "qassert.h" to the qpn_port.h header file in the application directory. Any QM models created for the previous QP-nano versions remain fully compatible with QP-nano 5.3.0, but you need to re-generate the code with QM 3.1.0.</dd></dl>
<p>This release comes with new and updated QDKs for MSP430. Specifically, new QDKs have been added for the MSP-EXP430G2 LaunchPad as well as the MSP-EXP420F5529LP LauchPad. Also, the QDKs for MSP430 with the TI Code Composer Studio are now part of the baseline QP-nano distribution.</p>
<p>This release also goes several steps towards compliance with the new MISRA-C:2012 rules. For example, unused tag declarations have been removed (MISRA-C:2012 Rule 2.4), the C99 standard Boolean data type in &lt;<a class="el" href="stdbool_8h.html" title="Boolean type and constansts. WG14/N843 C99 Standard, Section 7.16.">stdbool.h</a>&gt; has been added instead of uint8_t for stricter type analysis, and the C99 data types uint_fast8_t and uint_fast16_t are used instead of the non-standard uint_t.</p>
<p>Finally, this QP-nano release brings deep changes in the source code comments and the doxygen documentation generated from the source code. All comments have now more consistent structure, and every function is now documented in the implementation file (.c file), whereas the interface (.h files) contain only the brief descriptions of the functions. This re-structuring of documentation is performed as part of the validation and verification effort that has begun to provide a certification package for QP-nano for safety standards, such as IEC 61508 and ISO 62304 (FDA 510(k)).</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Moved detailed documentation of functions from the header files (.h) to implementation files (.c).</li>
<li>Added macros: <a class="el" href="qepn_8h.html#ac927f38462ffb9c8cca4e4f2920f8fcd" title="Macro to call in a state-handler when it executes a transition to history.">Q_TRAN_HIST()</a>, QM_TRAN_HIST(), and QM_TRAN_EP(), to "qepn.h"</li>
<li>Added attributes entryAction and initAction to the QMState struct in "qepn.h" (needed for transition to history).</li>
<li>Changed return type to bool in virtual functions QMsmVtbl.post() and QMsmVtbl.postISR() as well as the implementations: <a class="el" href="qfn_8h.html#a391b212c88303102ce22884bf6813fae" title="Implementation of the task-level event posting.">QActive_postX_()</a>, and <a class="el" href="qfn_8h.html#afb1add491f26a0d25cc7bec29758d4a4" title="Implementation of the ISR-level event posting.">QActive_postXISR_()</a>.</li>
<li>In <a class="el" href="qepn_8h.html" title="Public QEP-nano interface.">qepn.h</a>, changed the QState return type from action/state handler functions to uint_fast8_t.</li>
<li>In <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a>, changed the type of <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a> attributes prio, head, tail, and nUsed to uint_fast8_t.</li>
<li>In <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a>, changed the type of of QTimeEvtCtr, as well of the tickRate argument in <a class="el" href="qfn_8h.html#a48f78cdad2d12bbbd2fc584bab1c56c2" title="Processes all armed time events at every clock tick.">QF_tickXISR()</a>, <a class="el" href="qfn_8h.html#adbc1b10b5546d6441a823da4867f4692" title="Arm the QP-nano one-shot time event.">QActive_armX()</a>, and <a class="el" href="qfn_8h.html#acc54c1c6578d6cb53e2c8dd36370e3da" title="Disarm a time event.">QActive_disarmX()</a> to uint_fast8_t.</li>
<li>Changed the return type from QK_schedPrio_() (priority) as well as the p argument in <a class="el" href="qkn_8h.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK-nano scheduler finds the highest-priority thread ready to run.">QK_sched_()</a> to uint_fast8_t</li>
<li>Added new QDKs-nano/IAR for MSP-EXP430G2 LaunchPad</li>
<li>Added new QDKs-nano/IAR for MSP-EXP420F5529LP LauchPad LaunchPad</li>
<li>Added new QDKs-nano/CCS for MSP-EXP430G2 LaunchPad</li>
<li>Added new QDKs-nano/CCS for MSP-EXP420F5529LP LauchPad LaunchPad</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_2_0"></a>
Version 5.2.0, 2013-12-30</h1>
<p>This release matches the new QM 3.0.0, for which it provides model examples based on the new QMsm/QMActive classes. This, in turn demonstrates the new state machine code generation that QM3 was specifically designed to do.</p>
<p>This release also provides consistent API for late-binding ("virtual" functions) introduced in QP-nano 5.0.0, as opposed to using regular linking (early-binding) for direct function calls, such as QHsm_dispatch(). A clearly separated API compatibility layer is provided, whereas you can configure a level of backwards compatibility by means of the #QP_API_Version macro. This facilitates migrating existing QP applications to the newer API.</p>
<p>An cyclomatic complexity (McCabe V(G)) analysis of this Version has been performed and the maximum V(G) complexity per function has been reduced to 15 by breaking up the <a class="el" href="qepn_8h.html#ad29c2bfe203bc9e7415ca340e30da4ee" title="Implementation of dispatching events to QHsm.">QHsm_dispatch_()</a> function. The code metrics report, including cyclomatic complexity by function as well as other standard code metrics (e.g., lines of code), is now included in the "QP-nano Reference Manual", see <a href="https://www.state-machine.com/qpn/metrics.html">https://www.state-machine.com/qpn/metrics.html</a></p>
<p>Finally, this release demonstrates safer stack allocation and safer exception handlers in all ARM Cortex-M examples. The techniques are described in the Embedded.com article "Are We Shooting Ourselves in the
Foot with Stack Overflow?".</p>
<p>Changes in detail:</p>
<ol type="1">
<li>In file <a class="el" href="qepn_8h.html" title="Public QEP-nano interface.">qepn.h</a> renamed the implementation functions, such as QHsm_init() and QHsm_dispatch() to <a class="el" href="qepn_8h.html#abce9d9232e53dc4f4dda0b410d592c9d" title="Implementation of the top-most initial transition in QHsm.">QHsm_init_()</a> and <a class="el" href="qepn_8h.html#ad29c2bfe203bc9e7415ca340e30da4ee" title="Implementation of dispatching events to QHsm.">QHsm_dispatch_()</a> (note the underscore, which means that the functions should not be called directly by the application code). The only correct way of calling the functions is through the macros QMSM_INIT() and QMSM_DISPATCH(), respectively. The latter macros implement late-binding ("virtual" functions in C).</li>
<li>In file <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a> renamed the implementation functions, such as QActive_postX() and QActive_postXISR() to <a class="el" href="qfn_8h.html#a391b212c88303102ce22884bf6813fae" title="Implementation of the task-level event posting.">QActive_postX_()</a>, and QActive_postXISR_, respectively (note the underscore, which means that the functions should not be called directly by the application code). The only correct way of calling the functions is through the macros <a class="el" href="qfn_8h.html#ac41ac57f925509fc92f9b3612f8c03b5" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (task context).">QACTIVE_POST()</a>, <a class="el" href="qfn_8h.html#ae00de7cd5eab428566fb510ed63fac6b" title="Polymorphically posts an event to an active object (FIFO) without delivery guarantee (task context).">QACTIVE_POST_X()</a>, <a class="el" href="qfn_8h.html#ae87ff71293fcaf377be03122512ef95e" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (ISR context).">QACTIVE_POST_ISR()</a> and <a class="el" href="qfn_8h.html#afedb154580e5291936106181d89f84e4" title="Polymorphically posts an event to an active object (FIFO) without delivery guarantee (ISR context).">QACTIVE_POST_X_ISR()</a>. The latter macros implement late-binding ("virtual" functions in C).</li>
<li>for backwards compatibility, in files <a class="el" href="qepn_8h.html" title="Public QEP-nano interface.">qepn.h</a> and <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a> defined "API
Compatibility Layer", which is controlled by the macro <a class="el" href="qpn_8h.html#a3d046e1bb0df20880186bd32a31684f0" title="Macro that specifies the backwards compatibility with the QP-nano API version.">QP_API_VERSION</a>. For example, specifying QP_API_VERSION=500 chooses API compatible with QP Version 5.0.0 or newer, but excludes APIs that became deprecated in the earlier versions. If the macro #QP_API_Version is not defined by the user (typically on the command line for the compiler), the default value of 0 is assumed. This default means maximum backwards compatibility (from Version 0.0.0). On the other hand, higher values of #QP_API_Version mean less backwards compatibility. For example QP_API_VERSION=9999 will specify compatibility only with the latest Version of QP-nano. The API Compatibility Layer for QP_API_Version &lt; 500 provides macros: QHsm_init(), QHsm_dispatch(), QActive_post() and QActive_postISR(). These macros resolve to QMSM_INIT() and QMSM_DISPATCH(), <a class="el" href="qfn_8h.html#ac41ac57f925509fc92f9b3612f8c03b5" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (task context).">QACTIVE_POST()</a> and <a class="el" href="qfn_8h.html#ae87ff71293fcaf377be03122512ef95e" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (ISR context).">QACTIVE_POST_ISR()</a> respectively, so that calls based on the older API also use late-binging.</li>
<li>In file <a class="el" href="qepn_8c.html" title="QEP-nano implementation.">qepn.c</a>, broken up the function QHsm_dispatch() into two functions <a class="el" href="qepn_8h.html#ad29c2bfe203bc9e7415ca340e30da4ee" title="Implementation of dispatching events to QHsm.">QHsm_dispatch_()</a> and <a class="el" href="qepn_8c.html#a77af830458eae56ac0edf2136755ce4c" title="helper function to execute a transition chain in HSM">QHsm_tran_()</a>. This has reduced the cyclomatic complexity from 25 for the original function, to 11 and 15 for <a class="el" href="qepn_8h.html#ad29c2bfe203bc9e7415ca340e30da4ee" title="Implementation of dispatching events to QHsm.">QHsm_dispatch_()</a> and <a class="el" href="qepn_8c.html#a77af830458eae56ac0edf2136755ce4c" title="helper function to execute a transition chain in HSM">QHsm_tran_()</a>, respectively.</li>
<li>Updated all examples for ARM Cortex-M to use safer stack allocation and safer exception handlers in all ARM Cortex-M examples, as described in the Embedded.com article "Are We Shooting Ourselves in the Foot with
Stack Overflow?".</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_5_1_1"></a>
Version 5.1.1, 2013-10-15</h1>
<dl class="section note"><dt>Note</dt><dd>QP-nano 5.1.1 remains backwards-compatible with the existing QP-nano 4.x applications, except QP-nano 5.1.x requires changing the interrupt priority setting in the existing ARM Cortex-M applications. Specifically, you need to set the interrupt priorities equal or lower than <b>QF_AWARE_ISR_CMSIS_PRI</b> constant provided in the qfn_port.h header file.</dd></dl>
<p>The main purpose of this milestone QP-nano release is to enable the QM modeling tool to generate a new type of state machine code (requires QM Version 3.0.0, which is still in development as of this writing).</p>
<p>This new type of state machine implementation in QP-nano 5 is based on the new QMsm class, which takes advantage of the QM tool as an advanced "state machine compiler". QM can perform optimizations that were not possible with the C preprocessor alone. Specifically, the QM can easily determine the LCA (Least-Common-Ancestor) state for every transition and it can generate the complete transition-sequences (sequences of exit/entry/initial actions) at code-generation time. The resulting code can be still highly human-readable, but it will no longer be human-maintainable. The lab tests indicate that the new "housekeeping" code for executing hierarchical state machines can be about twice as fast as the previous code based on the <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> class. Additionally, the new code requires less run-time support (smaller event processor) and uses 70% less of stack space in the call to the QMsm_dispatch() operation than QHsm_dispatch().</p>
<p>The next big feature introduced in QP-nano 5 is polymorphism ("virtual" functions) for basic operations, such as state machine init() and dispatch() and active object post(), and postISR() operations. Making theses functions "virtual" means that all these operations can be re-defined in sub-classes of state machines and active objects. This, in turn, allows a single application to use a mix of state machine classes derived from the new QMsm base class with state machines derived from the <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> base class, each one using a different state machine implementation strategy. Additionally, the virtual post() operation could be very useful for implementing various Proxy active objects (e.g., for active object event posting across networks).</p>
<p>Another big feature introduced in QP-nano 5 are the multiple, independent system clock tick rates for time events. The number of system tick rates can be now configured in the QP-nano ports. For example, a digital watch can use a "fast" clock tick rate of 100Hz and a "slow" clock tick rate of only 1Hz. These clock tick rates can be managed independently, so for example, the fast clock tick rate can be shut down in the absence of time events assigned to this rate. This feature allows the applications to implement sophisticated power-saving policies.</p>
<p>As yet another important feature, QP-nano adds a new "extended" API for non-asserting event allocation and posting. This feature is intended for situations, where an application is hammered with external events that at times arrive too fast for processing, but that can be ignored under the overload conditions. In those cases firing an assertion inside the framework is undesirable. The non-asserting API allows a designer to request a safety-margin when allocating or posting an event. The event is not allocated/posted if the safety margin cannot be satisfied at the time of the call. On the other hand, the safety margin allows the application to still use the regular (asserting) event allocation and posting, because the event pools and event queues are guaranteed to maintain a minimal margin for safe operation.</p>
<p>Finally, QP-nano 5.1.0 never completely disables interrupts in the ARM Cortex-M3/M4 cores, even inside the critical sections. On Cortex-M3/M4 (ARMv7-M architectures), the QP port disables interrupts selectively using the BASEPRI register. (NOTE: The BASEPRI register is not implemented in the ARMv6-M architecture (Cortex-M0/M0+), so Cortex-M0/M0+ need to use the PRIMASK register to disable interrupts globally).</p>
<p>This new policy of disabling interrupts divides interrupts into "kernel-unaware" interrupts, which are never disabled, and "kernel-aware" interrupts, which are disabled in the QP critical sections. Only "kernel-aware" interrupts are allowed to call QP services. "Kernel-unaware" interrupts are <em>NOT</em> allowed to call any QP services and they can communicate with QP only by triggering a "kernel-aware" interrupt (which can post or publish events).</p>
<p>As mentioned above, all QP ports to ARM Cortex-M included in the QP 5.1.x Baseline Code provide the constant QF_AWARE_ISR_CMSIS_PRI, which must be used to offset the "kernel-aware" interrupt priorities.</p>
<p>All example projects for ARM Cortex-M included in the QP-nano 5.1.x Baseline Code demonstrate the recommended way of assigning interrupt priorities in your applications. The initialization consist of two steps:</p>
<ol type="1">
<li>you enumerate the "kernel-unaware" and "kernel-aware" interrupt priorities (whereas you offset the "kernel-aware" priorities by the constant QF_AWARE_ISR_CMSIS_PRI) and</li>
<li>you assign the priorities to <em>ALL</em> interrupts by calling the NVIC_SetPriority() CMSIS function.</li>
</ol>
<p>NOTE: Leaving the interrupt priority at the default value of zero (the highest priority) is most likely incorrect, because the "kernel-unaware" interrupts cannot call any QP services.</p>
<p>For more information, please read the short Application Note "Setting
ARM Cortex-M Interrupt Priorities in QP 5.1" available at: <a href="https://www.state-machine.com/arm/AN_ARM-Cortex-M_Interrupt-Priorities.pdf">https://www.state-machine.com/arm/AN_ARM-Cortex-M_Interrupt-Priorities.pdf</a>.</p>
<p>The following list details the changes:</p>
<ol type="1">
<li>Added the new QMsm "class" to <a class="el" href="qepn_8h.html" title="Public QEP-nano interface.">qepn.h</a>. Changed the inheritance tree by deriving <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> and QFsm from the QMsm base class. Added virtual table structures for QMsm, <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a>, and QFsm (polymorphism).<ul>
<li>added macro QMSM_INIT() to polymorphically call the state machine initialization implementation in the QMsm base class and all subclasses.</li>
<li>added macro QMSM_DISPATCH() to polymorphically call the state machine event dispatching implementation in the QMsm base class and all subclasses.</li>
</ul>
</li>
<li>Added the new "QMActive" "class" to <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a>. Extended the inheritance tree to derive QMActive from <a class="el" href="qfn_8h.html#struct_q_active" title="QActive active object (based on QHsm-implementation)">QActive</a>. Added virtual table structures for QMActive and QActvie (polymorphism).<ul>
<li>added macro <a class="el" href="qfn_8h.html#ac41ac57f925509fc92f9b3612f8c03b5" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (task context).">QACTIVE_POST()</a> to polymorphically call the direct event posting to an active object.</li>
<li>added macro <a class="el" href="qfn_8h.html#ae87ff71293fcaf377be03122512ef95e" title="Polymorphically posts an event to an active object (FIFO) with delivery guarantee (ISR context).">QACTIVE_POST_ISR()</a> to polymorphically call the postISR (posting from interrupts) to an active object.</li>
</ul>
</li>
<li>Added the multiple system clock tick rates feature in <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a>:<ul>
<li>added new configuration macro QF_MAX_TICK_RATE, which specifies the number of clock tick rates. This macro is to be defined in the QF ports (in the qpn_port.h header file). If the macro is undefined, the default value is 1 (one clock tick rate).</li>
<li>renamed and re-implemented the QF_tickISR() function as the "extended" <a class="el" href="qfn_8h.html#a48f78cdad2d12bbbd2fc584bab1c56c2" title="Processes all armed time events at every clock tick.">QF_tickXISR()</a> function with the argument 'tickRate' for processing time events allocated to different clock rates. The application must call QF_tickXISR(0), QF_tickXISR(1), ... at the specified tick rates from ISRs or <em>tasks</em>.</li>
<li>renamed and re-implemented the internal function QTimeEvt_arm_() to a public function <a class="el" href="qfn_8h.html#adbc1b10b5546d6441a823da4867f4692" title="Arm the QP-nano one-shot time event.">QActive_armX()</a> for arming time events initialized with the "extended" constructor. The <a class="el" href="qfn_8h.html#adbc1b10b5546d6441a823da4867f4692" title="Arm the QP-nano one-shot time event.">QActive_armX()</a> function is the new recommended API for arming time events, both one-shot and periodic.</li>
<li>re-implemented QActive_disarm().</li>
<li>extended QF_timerSetX_ to an array of [QF_MAX_TICK_RATE], so that every rate can be checked independently.</li>
</ul>
</li>
<li>Added the new non-asserting API to qf.h:<ul>
<li>added functions QActive_postX() and QActive_postXISR() to post an event to the given active object. The functions do not post the event if the target event queue has less free slots than the specified margin. The functions assert if the margin is zero and the event can't be posted.</li>
</ul>
</li>
<li>Changed the structure of the ARM Cortex-M ports<ul>
<li>renamed the sub-directory for ARM Cortex-M ports and examples from "arm-cortex" to "arm-cm". This is done to avoid confusion with other ARM Cortex variants, such as Cortex-A/R, which very different from Cortex-M.</li>
<li>removed the CMSIS (Cortex Microcontroller Software Interface Standard) directories from the Cortex-M examples and moved it to the common location in the QPN%/ports/arm-cm/cmsis/ directory. Upgraded the CMSIS to the latest Version 3.20.</li>
<li>added the ARM Cortex-M ports and examples with Keil/ARM MDK to the QP Baseline Code.</li>
<li>upgraded ARM Cortex-M ports with IAR to the latest IAR EWARM 6.60</li>
<li>upgraded ARM Cortex-M ports with Sourcery CodeBench to the latest Version 2013.05-53.</li>
</ul>
</li>
<li>Added the requested simple "Blinky" example for Windows and ARM Cortex-M (with the GNU, IAR, and Keil toolsets).<ul>
<li>Added "Getting Started with QP-nano" guide based on the Blinky example.</li>
</ul>
</li>
<li>Modified the application examples with PC-Lint (qpn/examples/arm-cm/gnu/dpp-qk_ek-lm3s811-lint and qpn/examples/arm-cm/iar/dpp-qk_ek-lm3s811-lint). Updated lint files for the latest PC-Lint</li>
<li>Ported all state pattern examples to Win32/MinGW. That way, all these examples can be run and modified directly on Windows, without going back to DOS.</li>
<li>Updated the Doxygen documentation (QP-nano Reference Manual)<ul>
<li>updated the QP-nano tutorial</li>
<li>updated and added documentation and code samples</li>
<li>added search box and tree-view panel to the HTML documentation</li>
</ul>
</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_5_04"></a>
Version 4.5.04, 2013-02-09</h1>
<p>The main purpose of this release is adding support for the ARM Cortex-M4F processors with the hardware Floating-Point Unit (FPU). The QP-nano ports to Cortex-M4F take full advantage of the "lazy stacking" feature of the FPU registers, and by doing so offer the most efficient preemptive multitasking on this processor.</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Added ports and examples for ARM Cortex-M4F with the EK-LM4F120XL board (Stellaris Launchpad).</li>
<li>Added the macro QF_LOG2(), which can be re-implemented in the QP-nano ports, if the CPU supports special instructions, such as CLZ (count leading zeros in Cortex-M3/M4). If the macro is not defined in the QP port, the default implementation uses a lookup table.</li>
<li>Updated all ARM Cortex-M ports and examples to the latest IAR EWARM 6.50 and Sourcery CodeBench 2012.09-85.</li>
<li>Updated App Notes "QP and ARM Cortex-M with IAR" and "QP and ARM
Cortex-M with GNU".</li>
<li>Updated the PC-Lint support files (include/lib-qpn.lnt, au-misra2.lnt) to the latest PC-Lint 9.00j.</li>
<li>Updated the Application Note: "QP-nano MISRA-C:2004 Compliance Matrix".</li>
<li>Spell-checked the comments in all QP-nano source files and removed several typos.</li>
<li>Removed the Qt ports and examples from the QP-nano Baseline Code and</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>QP-nano Version 4.5.04 preserves full compatibility with QM 2.2.03 and all existing QDKs for QP-nano 4.5.xx.</dd></dl>
<hr  />
 <h1><a class="anchor" id="qpn_4_5_03"></a>
Version 4.5.03, 2012-11-29</h1>
<p>This release changes the directory structure of QP-nano examples for various operating systems, such as POSIX (Linux, BSD, etc.), Win32 (Windows), Qt, etc. The OS examples are moved from the exampels/80x86/ directory one level up to examples/.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_5_02"></a>
Version 4.5.02, 2012-08-17</h1>
<p>The main purpose of this release is providing QM models in most examples and better, more comprehensive support for (rapid) prototyping of embedded QP applications on the desktop with the Win32 API and with Qt. Among others, this release adds a complete toolkit for creating realistic embedded front panels with pure Win32-GUI API and free Visual C++ Express and ResEdit. An extensive Application Note "QP and Win32" is included in this release.</p>
<p>This QP relase adds QM models, created with the new QM 2.2.01, to most of the examples. The code generated by this new QM version complies with MISRA-C:2004 rules.</p>
<p>This release adds the variable QF_timerSet_ and bookkeeping around it, so that the state of all timeouts in the system can be determined quickly and efficiently. This feature is for power- sensitive applications, where the system clock tick interrupt needs to be turned off. One of the criteria to entering such a sleep mode is that all timeout events are disarmed, that is, when (QF_timerSet_ == (uint8_t)0).</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Added QF_timerSet_ declaration to <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a> and setting/clearing this bitmask into <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> and qfn_init.c. This feature is controled by the configuration macro Q_TIMERSET.</li>
<li>Modified QP-nano port to Win32 and used the free Visual C++ Express 2010 with Platform SDK rather than Visual C++ Pro 2008. Provided a completely revised App Note "QP and Win32".</li>
<li>Renamed the port directory qt_1t/ to qt/.</li>
<li>Added QM models to most examples and used the automatically generated code from the models instead of the hand-written code.</li>
<li>Added .ui files to the Qt examples for generating UIs graphically with the Qt Designer tool. Revised and updated the App Note "QP and Qt".</li>
<li>Removed definition of the macro QF_FSM_ACTIVE from qpn_port.h files in &lt;qpn&gt;/examples/80x86/watcom/dpp and &lt;qpn&gt;/examples/80x86/watcom/game. This configuration conflicted with the actual definition of the active objects, which used hierarchical* state machines, not the "flat" state machines.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_5_01"></a>
Version 4.5.01, 2012-06-14</h1>
<p>The main purpose of this minor release is providing improved MISRA-compliant state machine implementation. Specifically, a new macro <a class="el" href="qepn_8h.html#a40a035a3e4679f8b35d81a7f49a6d44f" title="Macro to call in a state-handler when it attempts to handle an event but a guard condition evaluates ...">Q_UNHANDLED()</a> has been added for a situation when a guard condition evaluates to FALSE, but the state model does not prescribe the explicit [else] case for this guard. In this case, the state handler can return <a class="el" href="qepn_8h.html#a40a035a3e4679f8b35d81a7f49a6d44f" title="Macro to call in a state-handler when it attempts to handle an event but a guard condition evaluates ...">Q_UNHANDLED()</a>, which will cause the QEP event processor to propagate the event to the superstate, which is what UML semantics prescribes.</p>
<p>NOTE: These change to the QEP-nano event processor is completely backwards-compatible. All state hander functions coded the old way will continue to handle the guard conditions correctly and in accordance with the UML specification. The new <a class="el" href="qepn_8h.html#a40a035a3e4679f8b35d81a7f49a6d44f" title="Macro to call in a state-handler when it attempts to handle an event but a guard condition evaluates ...">Q_UNHANDLED()</a> macro is necessary only for MISRA-compliant state handler coding, which will be applied in the upcoming release of the QM modeling and code generation tool.</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Added macro <a class="el" href="qepn_8h.html#a40a035a3e4679f8b35d81a7f49a6d44f" title="Macro to call in a state-handler when it attempts to handle an event but a guard condition evaluates ...">Q_UNHANDLED()</a> and return value Q_RET_UNHANDLED in <a class="el" href="qepn_8h.html" title="Public QEP-nano interface.">qepn.h</a>.</li>
<li>Modified <a class="el" href="qepn_8c.html" title="QEP-nano implementation.">qepn.c</a> to handle the Q_RET_UNHANDLED return value.</li>
<li>Updated the QP-nano MISRA-C:2004 compliance matrix to include the new MISRA-compliant way of coding guard conditions.</li>
<li>Updated the IAR ARM compiler used in the ARM Cortex-M examples to the latest Version IAR EWARM 6.40.</li>
<li>Modified the Qt port not to define the QPApp::onClockTick() slot, but instead to allow defining this slot in the BSP of the application.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_5_00"></a>
Version 4.5.00, 2012-05-30</h1>
<p>The main pupose of this relase is to improve host-based development of QP-nano applications, which is critical for Test-Driven Development (TDD). Among others, this release provides integration between QP-nano and the popular Qt GUI framework, which allows developers to easily build host- based simulations of the embedded systems with the realistic user interfaces.</p>
<p>This realase also simplifies implementing transitions to history, which is a preparation to providing this feature in the QM modeling tool.</p>
<p>Changes in detail:</p>
<ol type="1">
<li>Renamed the event class from QEvent to <a class="el" href="qepn_8h.html#struct_q_evt" title="Event structure.">QEvt</a> to avoid a name conflict with the Qt framework.</li>
</ol>
<p>NOTE: To minimize impact of this change on the existing QP-nano ports and applications, the name QEvent is provided as well, but this can be suppressed by defining the configuration macro Q_NQEVENT in qep_port.h.</p>
<ol type="1">
<li>Added return value to <a class="el" href="qfn_8h.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF-nano to run the application.">QF_run()</a> to allow transfer of the exit status to the destop operating systems.</li>
</ol>
<p>NOTE: This modification haves impact on most QP-nano ports, because the <a class="el" href="qfn_8h.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF-nano to run the application.">QF_run()</a> function must now return a int16_t value.</p>
<ol type="1">
<li>Added member 'temp' to the <a class="el" href="qepn_8h.html#struct_q_hsm" title="Hierarchical State Machine.">QHsm</a> and QFsm base classes to prevent clobbering the current state (the 'state' member) during transitons. This change allows keeping the current state unchanged during the entire transition chain, which in turn allows easy and generic access to the state information to store the state history in the exit actions from states. Additional bonus of this re-design is the opportunity of testing for stable state configuration in assertions added to the <a class="el" href="qepn_8c.html" title="QEP-nano implementation.">qepn.c</a> file.</li>
<li>Added the <a class="el" href="qepn_8h.html#ab2a65d48fe96db91a3ca533410526afb" title="Obtain the current active state from a HSM (read only).">QHsm_state()</a> and QFsm_state() accessor macros.</li>
<li>Modified the "Transition to History" pattern implementation to use the simplified technique of obtaining the current state in the exit action from the superstate rather than all the exit actions from the substates. Modified the "State-Local Storage" (SLS) pattern as well, because it was using the transition to history constructs.</li>
<li>Modified the QP-nano port to Win32 (both the MinGW and VC2008).</li>
<li>Modified the QP-nano port to POSIX.</li>
<li>Added QP port to Qt (Qt with one thread) and two example applications (DPP and PELICAN crossing).</li>
<li>Added GNU compiler option -pthread to QP ports for POSIX with P-threads, including QP ports and examples for Linux and Mac OS X.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_4_00"></a>
Version 4.4.00, 2012-03-03</h1>
<p>The main pupose of this relase is MISRA-C:2004 compliance, strong-type checking compliance, update of PC-Lint option files and tests, and general cleanup.</p>
<ol type="1">
<li>For commonality with the QP/C and QP/C++ frameworks renamed macros QF_INT_LOCK/QF_INT_UNLOCK to QF_INT_DISABLE/QF_INT_ENABLE, respectively. Also renamed macros QF_INT_KEY_TYPE/QF_ISR_LOCK/QF_ISR_UNLOCK to QF_ISR_STAT_TYPE/QF_ISR_DISABLE/QF_ISR_RESTORE, respectively.</li>
</ol>
<p>NOTE: This modifications have impact on most QP-nano ports. However, the <a class="el" href="qfn_8h.html" title="Public QF-nano interface.">qfn.h</a> header file contains definitions of the new macros in terms of the old ones. This provies backwards comatibility of the existing QP-nano ports.</p>
<ol type="1">
<li>Added the PC-Lint option files <a class="el" href="std_8lnt.html" title="PC-Lint-Plus standard option file.">std.lnt</a> and lib-qpn.lnt to the qcn/include/ directory.</li>
<li>Cleaned the whole QP-nano code from lint comments. All PC-Lint options have been moved to PC-Lint option files.</li>
<li>Modified QP-nano assertion macro <a class="el" href="qassert_8h.html#a302498d7d57ae4196cb0745ac65959ae" title="Define the user-specified module name for assertions in this file.">Q_DEFINE_THIS_MODULE()</a> to avoid using the # operator (MISRA rule 19.13). This macro now requires the argument enclosed in doble quotes "".</li>
</ol>
<p>NOTE: This modification has impact on some QP-nano ports.</p>
<ol type="1">
<li>Added typedefs for char_t, int_t, float32_t, and float64_t to event.h header file for compliance with MISRA-C:2004 rules 6.1 and 6.3.</li>
<li>Added macros <a class="el" href="qepn_8h.html#a6531b0ab582f41275f19d28ac91d9e4f" title="Perform cast to QStateHandler.">Q_STATE_CAST()</a> and Q_ACTIVE_CAST() to qep.h to encapsulate deviation from MISRA-C rule 11.4.</li>
<li>Added macro <a class="el" href="qepn_8h.html#a7a86725df60bb442ac834093a779726f" title="Perform cast from unsigned integer to a pointer of type type_.">Q_UINT2PTR_CAST()</a> to encapsulate casting unsigned integers to pointers, which deviates from MISRA-C rule 11.3. This macro has been added for <em>application-level</em> code.</li>
<li>Updated ARM Cortex-M examples with the latest CMSIS v3.0, which complies with more MISRA-C:2004 rules.</li>
<li>Added PELICAN examples for MISRA-C:2004 compliant applications (for IAR-ARM and GNU-ARM).</li>
<li>Added testing of PC-Lint option files against the MISRA-C Exemplar Suite.</li>
<li>Updated ARM-Cortex-M3 port with GNU to the latest Sourcery CodeBench 2011.09-60.</li>
<li>Added documentation to QP-nano distribution in the directory qpn/doc/, with the following Application notes: "QP-nano MISRA-C:2004
Compliance Matrix" and "Quantum Leaps Coding Standard",</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_3_00"></a>
Version 4.3.00, 2011-10-31</h1>
<ol type="1">
<li>This release changes the partitioning of the QK-nano scheduler. Specifically, the QK-nano scheduler is now divided between two functions QK_schedPrio_() and <a class="el" href="qkn_8h.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK-nano scheduler finds the highest-priority thread ready to run.">QK_sched_()</a>, to calculate the highest- priority task ready to run and to perform scheduling, respectively. The function QK_schedPrio_() is useful to determine if scheduling is even necessary.</li>
<li>Reduced the interrupt latency of the QK-nano kernel by breaking up the critical section in the <a class="el" href="qkn_8h.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK-nano scheduler finds the highest-priority thread ready to run.">QK_sched_()</a> into two pieces, just after setting QK_currPrio_.</li>
<li>Modified the ARM Cortex-M port qkn_port.s to take advantage of the new structure of the QK-nano scheduler. To reduce code duplications, the QK-nano port file qkn_port.s has been placed in the directories: qpn/ports/arm-cortex/qk/gnu/ for the GNU compiler and qpn/ports/arm-cortex/qk/iar/ for the IAR compiler, respectively.</li>
<li>Moved the Win32 and POSIX emulation of QP-nano from the directory qpn/emulation/ to qpn/ports/win32/ and qpn/ports/posix/, respectively.</li>
<li>Renamed the function QF_tick() to QF_tickISR() to clearly notify the user that this function is callable from ISR only. For backwards compatibility, the macro QF_tick() is defined to QF_tickISR().</li>
<li>Modified QF_tickISR(), QActive_postISR(), QActive_post(), and <a class="el" href="qkn_8h.html#a49a6ff5d3a7c6ae58e33a2b943efb2fc" title="QK-nano scheduler finds the highest-priority thread ready to run.">QK_sched_()</a> to use stack-based pointer to <a class="el" href="qfn_8h.html#struct_q_active_c_b" title="QActive Control Block.">QActiveCB</a>, which avoids re-computation of the pointer on-the-fly in the loop. According to the feature request #3403079, this significantly speeds up the code for 8-bit PIC micros.</li>
<li>Upgraded the examples for ARM Cortex with IAR EWARM to the latest IAR EWARM Version 6.30.</li>
<li>Upgraded the examples for ARM Cortex with GNU (CodeSourcery) to the latest Sourcery CodeBench 2011.07-60.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_2_04"></a>
Version 4.2.04, 2011-09-24</h1>
<p>The main pupose of this relase is to provide a bug fix for the QK port to ARM Cortex processors. The bug fix addresses a very rare and undocumented behavior of late-arrival of an interrupt while entering the PendSV exception. In this case the PENDSVSET bit in the NVIC-ICSR register is <em>not</em> cleared when finally PendSV is entered, so the PendSV exception is entered in a <em>different</em> state when it is entered via the late-arrival mechanism versus the normal activation of the exception through tail-chaining. The consequence of this undocumented and inconsistent hardware behavior, PendSV could be re-entered again before the SVCall exception cleans up the stack. The bug fix is implemented in the qk_port.s file (in QP-nano this file is replicated in every example for QK-nano) and consists of clearing the PENDSVSET bit programmatically inside PendSV_Handler.</p>
<hr  />
 <h1><a class="anchor" id="qpc_4_2_02"></a>
Version 4.2.02, 2011-09-08</h1>
<p>The main pupose of this relase is to repackage the default QP-nano distribution to contain the single root directory qpn/ in the archive. That way, unziping the archive will produce only one directory (qpn/), which can be then changed by the user.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_2_01"></a>
Version 4.2.01, 2011-08-13</h1>
<ol type="1">
<li>Modified file <a class="el" href="qassert_8h.html" title="Customizable and memory-efficient assertions for embedded systems.">qassert.h</a> to add assertion macros <a class="el" href="qassert_8h.html#a8808a28cad1ff01daf65ca8ee37de314" title="General purpose assertion with user-specified assertion-id.">Q_ASSERT_ID</a>, <a class="el" href="qassert_8h.html#abacf59f21a2f59dc79ca39bb1ab9c3c0" title="Assertion for checking preconditions with user-specified assertion-id.">Q_REQUIRE_ID</a>, <a class="el" href="qassert_8h.html#aa8639670682ec29addc58801137f1e23" title="Assertion for checking postconditions with user-specified assertion-id.">Q_ENSURE_ID</a>, <a class="el" href="qassert_8h.html#aece62bcb3b8dbc7f070fb32a8b5ae184" title="Assertion for checking invariants with user-specified assertion-id.">Q_INVARIANT_ID</a>, and <a class="el" href="qassert_8h.html#ae16bddd04e54835e5bf8cbbb0ae90d30" title="Assertion with user-specified assertion-id for a wrong path.">Q_ERROR_ID</a>, which are better suited for unit testig, because they avoid the volatility of line numbers for indentifying assertions.</li>
<li>Modified the make files and project files to use the environment variable QPN instead of relying on the relative path to the QP-nano framework.</li>
<li>Added QP-nano examples for Mac OS X on 80x86.</li>
<li>Upgraded the examples for ARM Cortex with IAR EWARM to the latest IAR EWARM Version 6.20.</li>
<li>Upgraded the examples for MSP430 with IAR EW430 to the latest IAR EW430 Version 5.30.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_07"></a>
Version 4.1.07, 2011-02-28</h1>
<p>The goal of this release is to improve the ease of experimenting with QP-nano on the desktop. This release adds support for Windows (Win32) and Linux to the QP-nano baseline code. Two most popular compilers for Windows are supported: Microsoft Visual Studio and MinGW (GNU). The support for Linux includes pre-built examples and makefiles compatible with Eclipse.</p>
<p>The changes in detail are:</p>
<ol type="1">
<li>Added sub-directory qpn/emulation with emulation code for Windows (win32) and POSIX (Linux, Mac OS X, etc.).</li>
<li>Added Win32 examples for Visual C++ 2008 (examples/80x86/win32/ vc2008/dpp and examples/80x86/win32/vc2008/qhsmtst). Visual Studio soultions are provides for all build configurations.</li>
<li>Added Win32 examples for MinGW (examples/80x86/win32/mingw/dpp and examples/80x86/win32/mingw/qhsmtst). Eclipse-compatible makefiles are provided for all build configurations. NOTE: the Makefiles assume that the MinGW/bin directory is added to the PATH.</li>
<li>Fixed a bug in file <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a>, function QActive_postISR(). For special rare combination of configuration macros the assertion was checked before declaring an automatic variable QF_ISR_KEY_TYPE key. This declaration has been moved to the top of the function.</li>
<li>Upgraded the examples for ARM Cortex with CodeSourcery to the latest Sourcery G++ 2011.02-2.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_06"></a>
Version 4.1.06, 2011-01-07</h1>
<ol type="1">
<li>Made cosmetic improvements to the example QM model of the "Fly 'n' Shoot" game.</li>
<li>Made improvements in make.bat files for building the examples for DOS/Open Watcom to run better in DosBox on Linux.</li>
<li>Upgraded the examples for ARM Cortex with IAR to the latest IAR EWARM Version 6.10.</li>
<li>Upgraded the examples for ARM Cortex with CodeSourcery to the latest Sourcery G++ 2010.09-66.</li>
</ol>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_05"></a>
Version 4.1.05 (Product) Nov 01, 2010</h1>
<p>This release is adds examples for the QM (QP Modeler) graphical modeling and code generation tool. The examples are based on the "Fly 'n' Shoot" game described in the QP-nano Tutorial and in Chapter 1 of the PSiCC2 book.</p>
<p>Specifically, the directory qpn/examples/80x86/watcom/game-qm/ contains the "Fly 'n' Shoot" game model file "game.qm". This model, when opened in the QM tool contains all state machine diagrams and generates code into the subdirectory qm_code/. This code can then be built and executed on any 80x86 machine (newer versions of Windows or Linux require the DOSbox application, see <a href="http://www.dosbox.com">http://www.dosbox.com</a>).</p>
<p>The directory qpn/examples/arm-cortex/iar/game-ev-lm3s811-qm/ contains the Version of the game for the EV-LM3S811 ARM Cortex-M3 board. This directory contains the model file "game.qm", which is actually identical as the model in the DOS version. The LM3S811 Version needs to be compiled with the IAR compiler and executed on the EV-LM3S811 board.</p>
<p>Additionally, the QP-nano baseline code has been slighlty modified for better conformance to the MISRA C 2004 rules and the latest PC-Lint 9.x.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_04"></a>
Version 4.1.04, 2010-03-16</h1>
<p>This release is adds compatibility of all examples for DOS with the DOSBox emulator (<a href="http://www.dosbox.com/">http://www.dosbox.com/</a>) that recreates a MS-DOS compatible environment on all versions of Windows, including 64-bit Windows that don't run 16-bit DOS applications anymore.</p>
<p>Also, this release includes QP ports and examples for EV-LM3S811 board with the GNU-based Code Sourcery G++ toolset. Support for Sourcery G++ provides a very cost-effective option for developing QP applications for ARM Cortex MCUs.</p>
<p>Finally, this release improves the Cortex Microcontroller Software Interface Standard (CMSIS) for the whole family of the Stellaris LM3Sxxx MCUs. The improvement extends the CMSIS from Sandstorm to Fury, DustDevil, and Tempest Stellaris families.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_03"></a>
Version 4.1.03, 2010-01-21</h1>
<p>This release is concerned with the ARM Cortex ports and examples. Specifically, this release contains the following improvements:</p>
<ol type="1">
<li>Unified source code for ARM Cortex-M3 and the new ARM Cortex-M0 cores, including the code for the preemptive QK kernel.</li>
<li>Compliance with the Cortex Microcontroller Software Interface Standard (CMSIS) in all ARM Cortex examples.</li>
<li>Backward-compatible support for the new LM3S811 EVAL Rev C board with different OLED display than previous revisions. (NOTE: The OSRAM 96x16x1 OLED used in REV A-B boards has been replaced RITEK 96x16x1 OLED used in Rev C.)</li>
</ol>
<p>In the process of making the examples CMSIS-compliant, the dependency on the Luminary Micro driver library (driverlib.a) has been completely removed.</p>
<p>Additionally, the screen saver of the "Fly 'n' Shoot" game has been improved to periodically switch off the power of the OLED display, which better protects the display from burn-in. The affected file is tunnel.c.</p>
<p>Finally, this release introduces the QP_Version macro, which identifies the QP version. Otherwise, this maintenance release does not change the QP/C API in any way, so the release has NO IMPACT on the QP/C applications except for the ARM Cortex ports and applications.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_02"></a>
Version 4.1.02, 2010-01-14</h1>
<p>The purpose of this minor maintenance release is the change in the directory structure for the ARM Cortex ports and examples. As new ARM Cortex cores are becoming available, the old port name "cortex-m3" could be misleading, because it actually applies to wider range of ARM Cortex cores. Consequently, all ARM Cortex ports and examples are hosted in the directory tree called "arm-cortex".</p>
<p>This maintenance release does not change the QP-nano API in any way, so the release has NO IMPACT on the QP-nano applications except for the ARM Cortex ports and applications.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_01"></a>
Version 4.1.01, 2009-11-05</h1>
<p>The main purpose of this release is to replace the Turbo C++ 1.01 toolset with the Open Watcom C/C++ toolset, because Turbo C++ 1.01 is no longer available for a free download. In contrast, Open Watcom is distributed under an OSI-certified open source license, which permits free commercial and non-commercial use. Open Watcom can be downloaded from www.openwatcom.org.</p>
<p>All 80x86 examples (vanilla and QK-nano) for Turbo C++ 1.01 have been replaced with examples for Open Watcom. The make.bat scripts are provided to build the examples.</p>
<p>In the process of converting the examples to Open Watcom a new SLS example have been added to the standard QP-nano distribution. The SLS example located in &lt;qpn&gt;/examples/80x86/watcom/sls/ shows the QP-nano implemenation of the new State-Local Storage state design pattern.</p>
<hr  />
 <h1><a class="anchor" id="qpn_4_1_00"></a>
Version 4.1.00, 2009-10-09</h1>
<p>The main purpose of this release is to fix a bug in event posting, which could cause corruption of the event signal. Such corruption could occur when an event was posted to an empty event queue, in which case it was written directly to the internal event stored in the state machine, bypassing the ring-buffer. However, the signal of the internal event could also be changed by the QEP-nano event processor during execution of transitions.</p>
<p>The bug fix is to always pass events through the ring buffer and never overwrite the internal event during event posting (both from the task level and from the ISR level). The update of the ring buffer always occurs within a critical section and is safe from interruptions.</p>
<p>This bug fix also allows posting of events from the top-most initial transitions of active objects during the initialization phase. Previously, the execution of the top-most initial transition corrupted the signal of the internal event.</p>
<p>The bug fix enables also self-posting of events from entry/exit actions and internal initial transitions. Again, the QEP event processor corrupted the internal signal.</p>
<p>This release also replaces the static variables 'p' (priority) and 'a' (active object pointer) with automatic variables. This change results in more efficient code, because the frequently used variables can be kept in registers and do not need to be read/written from/to memory by each use.</p>
<p>Additionally, this release updates the QP-nano ARM Cortex-M3 examples for the EK-LM3S811 board to the latest IAR EWARM 5.40. Due to the acquisition of Liminary Micro by Texas Instruments the directory IAR structure for the examples and drivers has changed and the QP-nano examples had to be changed accordingly.</p>
<p>Finally, this release fixes a bug in the "Fly 'n' Shoot" game example for QP-nano, which caused an assertion if the Ship was moved to the very top of the Tunnel. This was due to the y-coordinate of the ship explosion becomoming negative.</p>
<p>NOTE: This release does not change the QP-nano API, but all event queues are effectively shortened by one event. Also it is no longer possible to declare an active object without a ring buffer (zero-sized queue), because the internal event no longer counts towards the queue depth.</p>
<p>The main changes in QP v4.1.00 with respect to the earlier versions are as follows:</p>
<ul>
<li>modified functions QActive_post(), QActive_postISR(), and <a class="el" href="qfn_8h.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF-nano to run the application.">QF_run()</a> in <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> to always use the ring buffer and not to count the internal event as part of the queue (in the assertions).</li>
<li>modified <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> to replace static variables 'p' and 'a' with automatic variables.</li>
<li>modified function QK_schedule_() in <a class="el" href="qkn_8c.html" title="QK-nano preemptive kernel implementation.">qkn.c</a> to always use the ring buffer, as described above.</li>
<li>modified module <a class="el" href="qkn_8c.html" title="QK-nano preemptive kernel implementation.">qkn.c</a> to to replace static variables 'p' and 'l_act' with automatic variables.</li>
<li>modified various examples to eliminate zero-sized queues and extend event queues by one event.</li>
<li>modified the ARM Cortex-M3 examples for the new IAR EWARM 5.40.</li>
<li>modified the ship.c and tunnel.c files in the "Fly 'n' Shoot" game example to fix the aforementioned bug.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_4_0_04"></a>
Version 4.0.04, 2009-04-09</h1>
<p>The maintenance release provides a fix for the compile-time assertions, which did not work correctly for the GNU compiler family. Also, the ARM Cortex-M3 examples have been recompiled with the newer IAR EWARM v5.30.</p>
<p>This maintenance release does not change the QP-nano API in any way, so the release has NO IMPACT on the QP-nano applications.</p>
<p>The main changes in QP v4.0.04 with respect to earlier Version are as follows:</p>
<ul>
<li>in <a class="el" href="qassert_8h.html" title="Customizable and memory-efficient assertions for embedded systems.">qassert.h</a> file the <a class="el" href="qassert_8h.html#a17f551ed8492f013d533f27353c091a3">Q_ASSERT_COMPILE</a> macro has been modified to render a negative array dimension when the asserted condition is not TRUE.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_4_0_03"></a>
Version 4.0.03, 2008-08-06</h1>
<p>The main purpose of this release is to "future-proof" the QK-nano preemptive kernel. The release 4.0.03 strictly preserves the semantics of QK_currPrio_ variable, which was violated by the previous QK mutex implementation. The mutex locking now uses a different variable QK_ceilingPrio_, which represents the ceiling-priority locked by the mutex. When the mutex is configured (the macro #QK_MUTEX is defined), the QK-nano scheduler performs an additional check to make sure that only tasks with priorities above the ceiling can run. This additional overhead is not present when #QK_MUTEX is not defined.</p>
<p>This maintenance release does not change the QP-nano API in any way, so the release has NO IMPACT on the QP-nano applications.</p>
<p>The main changes in QP v4.0.03 with respect to earlier Version are as follows:</p>
<ul>
<li>in <a class="el" href="qkn_8c.html" title="QK-nano preemptive kernel implementation.">qkn.c</a> file, changed priority-ceiling mutex implementation to use the QK_ceilingPrio_ instead of QK_currPrio_. Also added testing priority against the QK_ceilingPrio_, when the macro QK_MUTEX is defined.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_4_0_02"></a>
Version 4.0.02, 2008-08-06</h1>
<p>This maintenace release is made to allow posting events from any active object to any active object from the top-most initial transtions.</p>
<p>This maintenance release does not change the QP-nano API in any way, so the release has NO IMPACT on the QP-nano applications.</p>
<p>The main changes in QP v4.0.02 with respect to earlier Version are as follows:</p>
<ul>
<li>modified function <a class="el" href="qfn_8h.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF-nano to run the application.">QF_run()</a> in <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> to first loop over all active objects and initialize their priority attribute based on their location in the QF_active[] array. The second for-loop triggers only the initial transitions, but now all priorities are initialized, so active objects can post events to each others from the initial transitions.</li>
<li>modified function <a class="el" href="qfn_8h.html#a779a1bc9482e2d489dc87751cd100fdb" title="Transfers control to QF-nano to run the application.">QF_run()</a> in <a class="el" href="qkn_8c.html" title="QK-nano preemptive kernel implementation.">qkn.c</a> in identical way as in <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> described above.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_4_0_01"></a>
Version 4.0.01, 2008-06-08</h1>
<p>This maintenace release is made to allow compiling QP-nano with the GNU compiler for AVR (WinAVR). Specifically, some changes were necessary to accomodate the non-standard way of hanlding constant data objects allocated in ROM (PROGMEM) in the GNU compiler for AVR.</p>
<p>This maintenance release does not change the QP-nano API in any way, so the release has NO IMPACT on the QP-nano applications.</p>
<p>The main changes in QP v4.0.01 with respect to earlier Version are as follows:</p>
<ul>
<li>eliminated QF_pCB_ variable from <a class="el" href="qfn_8c.html" title="QF-nano implementation.">qfn.c</a> and <a class="el" href="qkn_8c.html" title="QK-nano preemptive kernel implementation.">qkn.c</a>. This variable was used to point to the constant active object control block (<a class="el" href="qfn_8h.html#struct_q_active_c_b" title="QActive Control Block.">QActiveCB</a>) in ROM. The GNU compliler for AVR could not handle such pointer correctly without contaminating the code with non-portable and non-standard extensions.</li>
<li>added Doxygen comments to the qep.h header file.</li>
<li>in <a class="el" href="qepn_8c.html" title="QEP-nano implementation.">qepn.c</a> file, broken up expressions of the form if (t == path[iq]) ... into (s = path[iq]; if (t == s) ...). This was done to accommodate the ImageCraft ICCM8C compiler for PSoC.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="qpn_4_0_00"></a>
Version 4.0.00, 2008-04-07</h1>
<p>This milestone release is made for the book /ref PSiCC2. The book describes in great detail this new release. The older "QP-nano Programmer's Manual" is now phased out and is replaced with this hyper-lirenked /ref main_page "QP-nano Reference Manual", which provides very detailed, easily searchable reference to the software. The book /ref PSiCC2 provies in-depth discussion of the relevant concepts as well as the design study of QP v4.0, including QP-nano v4.0 in Chapter 12.</p>
<p>The main changes in QP v4.0 with respect to earlier versions are as follows:</p>
<ul>
<li>the coding techniques for hierarchical state machines (HSMs) and the simpler finite state machines (FSMs) have changed. While the changes are quite simple, the backward compatibility with QEP-nano 3.x has been broken, meaning that some manual changes to the state machines implemented with earlier versions are necessary. Please refer to the "QP-nano Tutorial" Section /ref coding_hsm for more information about coding state machines with QEP 4.x.<ul>
<li>The main change is the signature of a state-handler function, which now returns simply a byte. This return type (typedef'ed as QState) is the status of the event-handling that the state handler conveys to the QEP event processor.</li>
<li>The macro <a class="el" href="qepn_8h.html#a8f06cd90ba5060780fc61a4810e3eb50" title="Macro to call in a state-handler when it executes a regular or and initial transition.">Q_TRAN()</a> must now always follow the return statement.</li>
<li>The new macro <a class="el" href="qepn_8h.html#ad8abd2f7098c41ec464343d9d8f1eadc" title="Macro to call in a state-handler when it designates the superstate of a given state.">Q_SUPER()</a> designates the superstate of the given state. Again, this macro must follow the return statement.</li>
<li>Then two new macros <a class="el" href="qepn_8h.html#a54b2da5e70ef983cfa7ca74deac237a3" title="Macro to call in a state-handler when it handles an event.">Q_HANDLED()</a> and #Q_IGNORED() have been added to return the status of event handled and event ignored, respectively.</li>
</ul>
</li>
<li>all callback functions are now consistently called /c #XXX_onYYY():<ul>
<li>Q_assert_handler() is now <a class="el" href="qassert_8h.html#ad3eef817e4c78a3740bea0edacb4adbd" title="Callback function invoked in case of any assertion failure.">Q_onAssert()</a></li>
<li>QF_start() is now <a class="el" href="qfn_8h.html#a189a6d2ece787717c81fbf51fd180732" title="Startup QF-nano callback.">QF_onStartup()</a></li>
<li>QF_cleanup() is now QF_onCleanup()</li>
</ul>
</li>
<li>all callback functions are now consistently called /c XXX_onYYY():<ul>
<li>Q_assert_handler() is now <a class="el" href="qassert_8h.html#ad3eef817e4c78a3740bea0edacb4adbd" title="Callback function invoked in case of any assertion failure.">Q_onAssert()</a></li>
<li>QF_start() is now <a class="el" href="qfn_8h.html#a189a6d2ece787717c81fbf51fd180732" title="Startup QF-nano callback.">QF_onStartup()</a></li>
<li>QF_cleanup() is now QF_onCleanup()</li>
</ul>
</li>
<li>enumerating global active object priorities is no longer necessary.</li>
<li>the methods of posting events have changed:<ul>
<li>QF_post(prio, sig, par) is now void QActive_post(me, sig, par)</li>
<li>QF_postISR(prio, sig, par) is now void QActive_postISR(me, sig, par)</li>
</ul>
</li>
<li>the global variable QF_activeNum has been eliminated<ul>
<li>instead the constant #QF_MAX_ACTIVE <b>must</b> correspond to the exact number of active objects in the application.</li>
</ul>
</li>
<li>the QEP-nano event processor now works identically as the full-Version QEP. Specifically, the signal of the current event is not used to notify the event processor that a transition has taken place. This saves a few bytes of code for every usage of <a class="el" href="qepn_8h.html#a8f06cd90ba5060780fc61a4810e3eb50" title="Macro to call in a state-handler when it executes a regular or and initial transition.">Q_TRAN()</a>.</li>
<li>all QF-nano and QK-nano functions have been modified to use static variables instead of stack variables wherever possible. This saves a few bytes of stack for the "vanilla" kernel. In QK-nano the savings can be more substantial.</li>
<li>the QP-nano event queues now decrement the head and tail counters. This leads to wrap-around at zero, which is easier (faster) to test than any other wrap-around point.</li>
<li>all examples in the standard QP-nano distribution have been cleaned up and updated to the latest QP-nano API changes. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QP-nano 6.8.0</b>
    </li>
  </ul>
</div>
</body>
</html>
